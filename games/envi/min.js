function Zone(t){this.newContent(t)}function Ocean(t){this.pollution=t}function Village(t){this.size=t}function Space(){}function Forrest(t){this.value=t}function nextToPollutedOcean(t){return"ocean"===t.zone.leftState().art&&2===t.zone.leftState().state||"ocean"===t.zone.rightState().art&&2===t.zone.rightState().state}function nextToBigVillage(t){return"village"===t.zone.leftState().art&&2===t.zone.leftState().state||"village"===t.zone.rightState().art&&2===t.zone.rightState().state}function nextToAtLeastMediumCleanWater(t){return"ocean"===t.zone.leftState().art&&t.zone.leftState().state<=1||"ocean"===t.zone.rightState().art&&t.zone.rightState().state<=1}function nextToAtLeastMediumVillage(t){return"village"===t.zone.leftState().art&&t.zone.leftState().state>=1||"village"===t.zone.rightState().art&&t.zone.rightState().state>=1}!function(){var t={},e=null,i=!0,n=!1;try{"undefined"!=typeof AudioContext?e=new AudioContext:"undefined"!=typeof webkitAudioContext?e=new webkitAudioContext:i=!1}catch(r){i=!1}if(!i)if("undefined"!=typeof Audio)try{new Audio}catch(r){n=!0}else n=!0;if(i){var o="undefined"==typeof e.createGain?e.createGainNode():e.createGain();o.gain.value=1,o.connect(e.destination)}var a=function(t){this._volume=1,this._muted=!1,this.usingWebAudio=i,this.ctx=e,this.noAudio=n,this._howls=[],this._codecs=t,this.iOSAutoEnable=!0};a.prototype={volume:function(t){var e=this;if(t=parseFloat(t),t>=0&&1>=t){e._volume=t,i&&(o.gain.value=t);for(var n in e._howls)if(e._howls.hasOwnProperty(n)&&e._howls[n]._webAudio===!1)for(var r=0;r<e._howls[n]._audioNode.length;r++)e._howls[n]._audioNode[r].volume=e._howls[n]._volume*e._volume;return e}return i?o.gain.value:e._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(t){var e=this;e._muted=t,i&&(o.gain.value=t?0:e._volume);for(var n in e._howls)if(e._howls.hasOwnProperty(n)&&e._howls[n]._webAudio===!1)for(var r=0;r<e._howls[n]._audioNode.length;r++)e._howls[n]._audioNode[r].muted=t},codecs:function(t){return this._codecs[t]},_enableiOSAudio:function(){var t=this;if(!e||!t._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){t._iOSEnabled=!1;var i=function(){var n=e.createBuffer(1,1,22050),r=e.createBufferSource();r.buffer=n,r.connect(e.destination),"undefined"==typeof r.start?r.noteOn(0):r.start(0),setTimeout(function(){(r.playbackState===r.PLAYING_STATE||r.playbackState===r.FINISHED_STATE)&&(t._iOSEnabled=!0,t.iOSAutoEnable=!1,window.removeEventListener("touchstart",i,!1))},0)};return window.addEventListener("touchstart",i,!1),t}}};var s=null,c={};n||(s=new Audio,c={mp3:!!s.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!s.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!s.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!s.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!s.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(s.canPlayType("audio/x-m4a;")||s.canPlayType("audio/m4a;")||s.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(s.canPlayType("audio/x-mp4;")||s.canPlayType("audio/mp4;")||s.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!s.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var u=new a(c),h=function(t){var n=this;n._autoplay=t.autoplay||!1,n._buffer=t.buffer||!1,n._duration=t.duration||0,n._format=t.format||null,n._loop=t.loop||!1,n._loaded=!1,n._sprite=t.sprite||{},n._src=t.src||"",n._pos3d=t.pos3d||[0,0,-.5],n._volume=void 0!==t.volume?t.volume:1,n._urls=t.urls||[],n._rate=t.rate||1,n._model=t.model||null,n._onload=[t.onload||function(){}],n._onloaderror=[t.onloaderror||function(){}],n._onend=[t.onend||function(){}],n._onpause=[t.onpause||function(){}],n._onplay=[t.onplay||function(){}],n._onendTimer=[],n._webAudio=i&&!n._buffer,n._audioNode=[],n._webAudio&&n._setupAudioNode(),"undefined"!=typeof e&&e&&u.iOSAutoEnable&&u._enableiOSAudio(),u._howls.push(n),n.load()};if(h.prototype={load:function(){var t=this,e=null;if(n)return void t.on("loaderror");for(var i=0;i<t._urls.length;i++){var r,o;if(t._format)r=t._format;else{if(o=t._urls[i],r=/^data:audio\/([^;,]+);/i.exec(o),r||(r=/\.([^.]+)$/.exec(o.split("?",1)[0])),!r)return void t.on("loaderror");r=r[1].toLowerCase()}if(c[r]){e=t._urls[i];break}}if(!e)return void t.on("loaderror");if(t._src=e,t._webAudio)d(t,e);else{var s=new Audio;s.addEventListener("error",function(){s.error&&4===s.error.code&&(a.noAudio=!0),t.on("loaderror",{type:s.error?s.error.code:0})},!1),t._audioNode.push(s),s.src=e,s._pos=0,s.preload="auto",s.volume=u._muted?0:t._volume*u.volume();var h=function(){t._duration=Math.ceil(10*s.duration)/10,0===Object.getOwnPropertyNames(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play(),s.removeEventListener("canplaythrough",h,!1)};s.addEventListener("canplaythrough",h,!1),s.load()}return t},urls:function(t){var e=this;return t?(e.stop(),e._urls="string"==typeof t?[t]:t,e._loaded=!1,e.load(),e):e._urls},play:function(t,i){var n=this;return"function"==typeof t&&(i=t),t&&"function"!=typeof t||(t="_default"),n._loaded?n._sprite[t]?(n._inactiveNode(function(r){r._sprite=t;var o=r._pos>0?r._pos:n._sprite[t][0]/1e3,a=0;n._webAudio?(a=n._sprite[t][1]/1e3-r._pos,r._pos>0&&(o=n._sprite[t][0]/1e3+o)):a=n._sprite[t][1]/1e3-(o-n._sprite[t][0]/1e3);var s,c=!(!n._loop&&!n._sprite[t][2]),h="string"==typeof i?i:Math.round(Date.now()*Math.random())+"";if(function(){var e={id:h,sprite:t,loop:c};s=setTimeout(function(){!n._webAudio&&c&&n.stop(e.id).play(t,e.id),n._webAudio&&!c&&(n._nodeById(e.id).paused=!0,n._nodeById(e.id)._pos=0,n._clearEndTimer(e.id)),n._webAudio||c||n.stop(e.id),n.on("end",h)},1e3*a),n._onendTimer.push({timer:s,id:e.id})}(),n._webAudio){var d=n._sprite[t][0]/1e3,l=n._sprite[t][1]/1e3;r.id=h,r.paused=!1,p(n,[c,d,l],h),n._playStart=e.currentTime,r.gain.value=n._volume,"undefined"==typeof r.bufferSource.start?r.bufferSource.noteGrainOn(0,o,a):r.bufferSource.start(0,o,a)}else{if(4!==r.readyState&&(r.readyState||!navigator.isCocoonJS))return n._clearEndTimer(h),function(){var e=n,o=t,a=i,s=r,c=function(){e.play(o,a),s.removeEventListener("canplaythrough",c,!1)};s.addEventListener("canplaythrough",c,!1)}(),n;r.readyState=4,r.id=h,r.currentTime=o,r.muted=u._muted||r.muted,r.volume=n._volume*u.volume(),setTimeout(function(){r.play()},0)}return n.on("play"),"function"==typeof i&&i(h),n}),n):("function"==typeof i&&i(),n):(n.on("load",function(){n.play(t,i)}),n)},pause:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.pause(t)}),e;e._clearEndTimer(t);var i=t?e._nodeById(t):e._activeNode();if(i)if(i._pos=e.pos(null,t),e._webAudio){if(!i.bufferSource||i.paused)return e;i.paused=!0,"undefined"==typeof i.bufferSource.stop?i.bufferSource.noteOff(0):i.bufferSource.stop(0)}else i.pause();return e.on("pause"),e},stop:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.stop(t)}),e;e._clearEndTimer(t);var i=t?e._nodeById(t):e._activeNode();if(i)if(i._pos=0,e._webAudio){if(!i.bufferSource||i.paused)return e;i.paused=!0,"undefined"==typeof i.bufferSource.stop?i.bufferSource.noteOff(0):i.bufferSource.stop(0)}else isNaN(i.duration)||(i.pause(),i.currentTime=0);return e},mute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.mute(t)}),e;var i=t?e._nodeById(t):e._activeNode();return i&&(e._webAudio?i.gain.value=0:i.muted=!0),e},unmute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.unmute(t)}),e;var i=t?e._nodeById(t):e._activeNode();return i&&(e._webAudio?i.gain.value=e._volume:i.muted=!1),e},volume:function(t,e){var i=this;if(t=parseFloat(t),t>=0&&1>=t){if(i._volume=t,!i._loaded)return i.on("play",function(){i.volume(t,e)}),i;var n=e?i._nodeById(e):i._activeNode();return n&&(i._webAudio?n.gain.value=t:n.volume=t*u.volume()),i}return i._volume},loop:function(t){var e=this;return"boolean"==typeof t?(e._loop=t,e):e._loop},sprite:function(t){var e=this;return"object"==typeof t?(e._sprite=t,e):e._sprite},pos:function(t,i){var n=this;if(!n._loaded)return n.on("load",function(){n.pos(t)}),"number"==typeof t?n:n._pos||0;t=parseFloat(t);var r=i?n._nodeById(i):n._activeNode();if(r)return t>=0?(n.pause(i),r._pos=t,n.play(r._sprite,i),n):n._webAudio?r._pos+(e.currentTime-n._playStart):r.currentTime;if(t>=0)return n;for(var o=0;o<n._audioNode.length;o++)if(n._audioNode[o].paused&&4===n._audioNode[o].readyState)return n._webAudio?n._audioNode[o]._pos:n._audioNode[o].currentTime},pos3d:function(t,e,i,n){var r=this;if(e="undefined"!=typeof e&&e?e:0,i="undefined"!=typeof i&&i?i:-.5,!r._loaded)return r.on("play",function(){r.pos3d(t,e,i,n)}),r;if(!(t>=0||0>t))return r._pos3d;if(r._webAudio){var o=n?r._nodeById(n):r._activeNode();o&&(r._pos3d=[t,e,i],o.panner.setPosition(t,e,i),o.panner.panningModel=r._model||"HRTF")}return r},fade:function(t,e,i,n,r){var o=this,a=Math.abs(t-e),s=t>e?"down":"up",c=a/.01,u=i/c;if(!o._loaded)return o.on("load",function(){o.fade(t,e,i,n,r)}),o;o.volume(t,r);for(var h=1;c>=h;h++)!function(){var t=o._volume+("up"===s?.01:-.01)*h,i=Math.round(1e3*t)/1e3,a=e;setTimeout(function(){o.volume(i,r),i===a&&n&&n()},u*h)}()},fadeIn:function(t,e,i){return this.volume(0).play().fade(0,t,e,i)},fadeOut:function(t,e,i,n){var r=this;return r.fade(r._volume,t,e,function(){i&&i(),r.pause(n),r.on("end")},n)},_nodeById:function(t){for(var e=this,i=e._audioNode[0],n=0;n<e._audioNode.length;n++)if(e._audioNode[n].id===t){i=e._audioNode[n];break}return i},_activeNode:function(){for(var t=this,e=null,i=0;i<t._audioNode.length;i++)if(!t._audioNode[i].paused){e=t._audioNode[i];break}return t._drainPool(),e},_inactiveNode:function(t){for(var e=this,i=null,n=0;n<e._audioNode.length;n++)if(e._audioNode[n].paused&&4===e._audioNode[n].readyState){t(e._audioNode[n]),i=!0;break}if(e._drainPool(),!i){var r;if(e._webAudio)r=e._setupAudioNode(),t(r);else{e.load(),r=e._audioNode[e._audioNode.length-1];var o=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",a=function(){r.removeEventListener(o,a,!1),t(r)};r.addEventListener(o,a,!1)}}},_drainPool:function(){var t,e=this,i=0;for(t=0;t<e._audioNode.length;t++)e._audioNode[t].paused&&i++;for(t=e._audioNode.length-1;t>=0&&!(5>=i);t--)e._audioNode[t].paused&&(e._webAudio&&e._audioNode[t].disconnect(0),i--,e._audioNode.splice(t,1))},_clearEndTimer:function(t){for(var e=this,i=0,n=0;n<e._onendTimer.length;n++)if(e._onendTimer[n].id===t){i=n;break}var r=e._onendTimer[i];r&&(clearTimeout(r.timer),e._onendTimer.splice(i,1))},_setupAudioNode:function(){var t=this,i=t._audioNode,n=t._audioNode.length;return i[n]="undefined"==typeof e.createGain?e.createGainNode():e.createGain(),i[n].gain.value=t._volume,i[n].paused=!0,i[n]._pos=0,i[n].readyState=4,i[n].connect(o),i[n].panner=e.createPanner(),i[n].panner.panningModel=t._model||"equalpower",i[n].panner.setPosition(t._pos3d[0],t._pos3d[1],t._pos3d[2]),i[n].panner.connect(i[n]),i[n]},on:function(t,e){var i=this,n=i["_on"+t];if("function"==typeof e)n.push(e);else for(var r=0;r<n.length;r++)e?n[r].call(i,e):n[r].call(i);return i},off:function(t,e){var i=this,n=i["_on"+t],r=e?e.toString():null;if(r){for(var o=0;o<n.length;o++)if(r===n[o].toString()){n.splice(o,1);break}}else i["_on"+t]=[];return i},unload:function(){for(var e=this,i=e._audioNode,n=0;n<e._audioNode.length;n++)i[n].paused||(e.stop(i[n].id),e.on("end",i[n].id)),e._webAudio?i[n].disconnect(0):i[n].src="";for(n=0;n<e._onendTimer.length;n++)clearTimeout(e._onendTimer[n].timer);var r=u._howls.indexOf(e);null!==r&&r>=0&&u._howls.splice(r,1),delete t[e._src],e=null}},i)var d=function(e,i){if(i in t)return e._duration=t[i].duration,void f(e);if(/^data:[^;]+;base64,/.test(i)){for(var n=atob(i.split(",")[1]),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);l(r.buffer,e,i)}else{var a=new XMLHttpRequest;a.open("GET",i,!0),a.responseType="arraybuffer",a.onload=function(){l(a.response,e,i)},a.onerror=function(){e._webAudio&&(e._buffer=!0,e._webAudio=!1,e._audioNode=[],delete e._gainNode,delete t[i],e.load())};try{a.send()}catch(s){a.onerror()}}},l=function(i,n,r){e.decodeAudioData(i,function(e){e&&(t[r]=e,f(n,e))},function(t){n.on("loaderror")})},f=function(t,e){t._duration=e?e.duration:t._duration,0===Object.getOwnPropertyNames(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play()},p=function(i,n,r){var o=i._nodeById(r);o.bufferSource=e.createBufferSource(),o.bufferSource.buffer=t[i._src],o.bufferSource.connect(o.panner),o.bufferSource.loop=n[0],n[0]&&(o.bufferSource.loopStart=n[1],o.bufferSource.loopEnd=n[1]+n[2]),o.bufferSource.playbackRate.value=i._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:u,Howl:h}}),"undefined"!=typeof exports&&(exports.Howler=u,exports.Howl=h),"undefined"!=typeof window&&(window.Howler=u,window.Howl=h)}();var iterateEntries=function(t){"use strict";function e(e,i,n){t.keys(e).forEach(function(t){i.call(n,e[t],t)})}return e}(Object),iterateSomeEntries=function(){"use strict";function t(t,e,i){Object.keys(t).some(function(n){return e.call(i,t[n])})}return t}(),concatenateProperties=function(t){"use strict";function e(e,i){t.keys(e).forEach(function(t){i[t]=e[t]})}return e}(Object),getFunctionName=function(){"use strict";function t(t){var e=t.toString(),i="function ".length,n=e.indexOf("(");return e.slice(i,n)}return t}(),Vectors=function(t){"use strict";return{get:function(t,e,i,n){return{x:i-t,y:n-e}},magnitude:function(e,i){return t.sqrt(e*e+i*i)},squaredMagnitude:function(t,e){return t*t+e*e},normalize:function(t,e){var i=this.magnitude(t,e);return this.normalizeWithMagnitude(t,e,i)},normalizeWithMagnitude:function(t,e,i){return{x:t/i,y:e/i}},normalRight:function(t,e){return{x:-e,y:t}},normalLeft:function(t,e){return{x:e,y:-t}},dotProduct:function(t,e,i,n){return t*i+e*n},toRadians:function(e){return e*t.PI/180},getX:function(e,i,n){return e+i*t.cos(n)},getY:function(e,i,n){return e+i*t.sin(n)},getAngle:function(e,i){return t.atan2(e,i)},getIntersectionPoint:function(t,e,i,n,r,o,a,s){var c=(s-o)*(i-t)-(a-r)*(n-e),u=((a-r)*(e-o)-(s-o)*(t-r))/c;return{x:t+u*(i-t),y:e+u*(n-e)}}}}(Math),Stats=function(t,e){"use strict";var i=e.now(),n=i,r=0,o=1/0,a=0,s=0,c=1/0,u=0,h=0;return{getFps:function(){return s},getMs:function(){return r},start:function(){i=e.now()},end:function(){var d=e.now();r=d-i,o=t.min(o,r),a=t.max(a,r),h++,d>n+1e3&&(s=t.round(1e3*h/(d-n)),c=t.min(c,s),u=t.max(u,s),n=d,h=0)}}}(Math,Date),getDevicePixelRatio=function(t){"use strict";var e;"screen"in t&&(e=t.screen.deviceXDPI/t.screen.logicalXDPI);var i=t.devicePixelRatio||e||1;return function(){return i}}(window),Event={RESIZE:"resize",SCREEN_ORIENTATION:"orientation",FULL_SCREEN:"full_screen",KEY_BOARD:"key_board",GAME_PAD:"game_pad",POINTER:"pointer",DEVICE_ORIENTATION:"device_orientation",PAGE_VISIBILITY:"page_visibility",TICK_START:"tick_start",TICK_INPUT:"tick_input",TICK_MOVE:"tick_move",TICK_COLLISION:"tick_collision",TICK_CAMERA:"tick_camera",TICK_DRAW:"tick_draw",TICK_END:"tick_end",PAUSE:"pause",RESUME:"resume",REMOVE_GO_FULL_SCREEN:"remove_go_full_screen",SHOW_GO_FULL_SCREEN:"show_go_full_screen",REMOVE_ROTATE_DEVICE:"remove_rotate_device",SHOW_ROTATE_DEVICE:"show_rotate_device",RESUME_MENU:"resume_menu",SHOW_MENU:"show_menu",RESUME_AFTER_MENU:"resume_after_menu"},resolveAtlasPaths=function(){"use strict";function t(t,e){return o+"_"+t+"_"+e}function e(e,i){for(var n=[],r=0;i>r;r++)n.push(t(r,e));return n}function i(t,i){for(var o=t>i?t:i,a=0;a<r.length;a++){var s=r[a];if(o<=s.size)return{paths:n(e(s.size,s.count)),defaultSize:s.size}}var c=r[r.length-1];return{paths:n(e(c.size,c.count)),defaultSize:c.size}}function n(t){var e=[];return t.forEach(function(t){e.push({gfx:"gfx/"+t+".png",data:"data/"+t+".json"})}),e}var r=[{size:2220,count:1}],o="atlas";return i}(),SoundFilesManager=function(t){"use strict";function e(){this.soundDict={}}e.prototype.load=function(t){var e=this;t.forEach(function(t){e.add(t)})};var i="sfx/",n=".mp3";return e.prototype.add=function(e){this.soundDict[e]=new t({urls:[i+e+n]})},e.prototype.play=function(t){var e=this.soundDict[t];e&&e.play()},e}(Howl),SoundSpriteManager=function(t){"use strict";function e(){this.sounds=null}return e.prototype.load=function(e){this.sounds=new t(e)},e.prototype.play=function(t){this.sounds.play(t)},e}(Howl),LinePath=function(){"use strict";function t(t,e,i,n,r,o,a,s,c){this.startX=t,this.startY=e,this.endX=i,this.endY=n,this.vectorX=r,this.vectorY=o,this.unitVectorX=a,this.unitVectorY=s,this.length=c}return t}(),CirclePath=function(){"use strict";function t(t,e,i,n,r){this.x=t,this.y=e,this.radius=i,this.startAngle=n,this.endAngle=r}return t}(),BezierCurvePath=function(){"use strict";function t(t,e,i,n,r,o,a,s){this.pointA_x=t,this.pointA_y=e,this.pointB_x=i,this.pointB_y=n,this.pointC_x=r,this.pointC_y=o,this.pointD_x=a,this.pointD_y=s}return t}(),Repository=function(t){"use strict";function e(){this.dict={}}return e.prototype.add=function(t,e,i){this.dict[t.id]={fn:e,dependencies:i}},e.prototype.has=function(t){return void 0!==this.dict[t.id]},e.prototype.remove=function(t){delete this.dict[t.id]},e.prototype.call=function(e,i){function n(t,a,s){o[t]=!0,s&&s.forEach(function(t){var e=t&&!o[t.id];if(e){var i=r.dict[t.id];i&&n(t.id,i.fn,i.dependencies)}}),a(e,i)}var r=this,o={};t.keys(this.dict).forEach(function(t){var e=this.dict[t];n(t,e.fn,e.dependencies)},this)},e}(Object),changePath=function(t,e,i,n,r){"use strict";function o(t,o,a,s,c,u,h,d,l){var f=t.curve;if(f instanceof i){var p=n.get(o,a,s,c),g=n.magnitude(p.x,p.y),m=n.normalize(p.x,p.y);f.startX=o,f.startY=a,f.endX=s,f.endY=c,f.length=g,f.unitVectorX=m.x,f.unitVectorY=m.y,f.vectorX=p.x,f.vectorY=p.y}else f instanceof r?(f.x=o,f.y=a,f.radius=s):f instanceof e&&(f.pointA_x=o,f.pointA_y=a,f.pointB_x=u,f.pointB_y=h,f.pointC_x=d,f.pointC_y=l,f.pointD_x=s,f.pointD_y=c)}return o}(Math,BezierCurvePath,LinePath,Vectors,CirclePath),changeCoords=function(){"use strict";function t(t,e,i){t.x=e,t.y=i}return t}(),changeTouchable=function(){"use strict";function t(t,e,i,n,r){t.x=e,t.y=i,t.width=n,t.height=r}return t}(),changeRectangle=function(){"use strict";function t(t,e,i,n){t.width=e,t.height=i,t.lineWidth=n}return t}(),changeMask=function(){"use strict";function t(t,e,i,n,r){t.x=e,t.y=i,t.width=n-t.x,t.height=r-t.y}return t}(),fetchDrawableIntoTouchable=function(t){"use strict";function e(e,i){t(e,i.getCornerX(),i.getCornerY(),i.getWidth(),i.getHeight())}return e}(changeTouchable),calcScreenConst=function(t){"use strict";function e(e,i,n){return t.floor(e/i*(n||1))}return e}(Math),add=function(){"use strict";function t(t,e){return function(i,n){return t(i,n)+e(i,n)}}return t}(),changeSign=function(){"use strict";function t(t){return function(e,i){return-t(e,i)}}return t}(),subtract=function(){"use strict";function t(t,e){return function(i,n){return t(i,n)-e(i,n)}}return t}(),multiply=function(){"use strict";function t(t,e){return function(i,n){return t(i,n)*e}}return t}(),zero=function(){"use strict";function t(){return 0}return t}(),wrap=function(){"use strict";function t(t){return function(){return t}}return t}(),Height=function(t){"use strict";return{_400:function(e){return t(e,6,5)},BOTTOM_RASTER:function(e){return t(e,20,19)},TOP_RASTER:function(e){return t(e,20)},FULL:function(t){return t},FIFTH:function(e){return t(e,5)},FOUR_FIFTH:function(e){return t(e,5,4)},HALF:function(e){return t(e,2)},QUARTER:function(e){return t(e,4)},THIRD:function(e){return t(e,3)},THREE_FIFTH:function(e){return t(e,5,3)},THREE_QUARTER:function(e){return t(e,4,3)},TWO_FIFTH:function(e){return t(e,5,2)},TWO_THIRD:function(e){return t(e,3,2)},get:function(e,i){return function(n){return t(n,e,i)}}}}(calcScreenConst),Width=function(t){"use strict";return{FULL:function(t){return t},HALF:function(e){return t(e,2)},QUARTER:function(e){return t(e,4)},THIRD:function(e){return t(e,3)},THREE_QUARTER:function(e){return t(e,4,3)},TWO_THIRD:function(e){return t(e,3,2)},get:function(e,i){return function(n){return t(n,e,i)}}}}(calcScreenConst),Font=function(t){"use strict";return{_5:function(e,i){return t(i,5)},_10:function(e,i){return t(i,10)},_15:function(e,i){return t(i,15)},_20:function(e,i){return t(i,20)},_25:function(e,i){return t(i,25)},_30:function(e,i){return t(i,30)},_35:function(e,i){return t(i,35)},_40:function(e,i){return t(i,40)},_60:function(e,i){return t(i,60)},get:function(e,i){return function(n,r){return t(r,e,i)}}}}(calcScreenConst),Transition=function(t){"use strict";function e(t,e,i,n){return i*t/n+e}function i(e,i,n,r){return 0==e?i:e==r?i+n:(e/=r/2)<1?n/2*t.pow(2,10*(e-1))+i:n/2*(-t.pow(2,-10*--e)+2)+i}function n(e,i,n,r){if(0==e)return i;if(1==(e/=r))return i+n;var o=.3*r,a=n<t.abs(n)?o/4:o/(2*t.PI)*t.asin(n/n);return n*t.pow(2,-10*e)*t.sin(2*(e*r-a)*t.PI/o)+n+i}function r(e,i,n,r){if(0==e)return i;if(1==(e/=r))return i+n;var o,a=.3*r;return o=n<t.abs(n)?a/4:a/(2*t.PI)*t.asin(n/n),n*t.pow(2,-10*e)*t.sin(2*(e*r-o)*t.PI/a)+n+i}function o(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e}function a(e,i,n,r){return 0!=e?n*t.pow(2,10*(e/r-1))+i:i}function s(e,i,n,r){return e==r?i+n:n*(-t.pow(2,-10*e/r)+1)+i}function c(t,e,i,n){return i*(t/=n)*t+e}function u(t,e,i,n){return-i*(t/=n)*(t-2)+e}function h(t,e,i,n){return t/=n/2,i/2*(--t*t*t*t*t+1)+e}function d(e,i,n,r){return(e/=r/2)<1?n/2*t.sin(t.PI*e/2)+i:-n/2*(t.cos(t.PI*--e/2)-2)+i}function l(e,i,n,r){return-n/2*(t.cos(t.PI*e/r)-1)+i}function f(e,i,n,r){return n*t.sin(e/r*(t.PI/2))+i}function p(e,i,n,r){return-n/2*(t.cos(t.PI*e/r)-1)+i}function g(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}return{LINEAR:e,EASE_OUT_BOUNCE:g,EASE_OUT_ELASTIC:r,EASE_IN_OUT_ELASTIC:n,EASE_IN_EXPO:a,EASE_OUT_EXPO:s,EASE_IN_OUT_EXPO:i,EASE_IN_QUAD:c,EASE_OUT_QUAD:u,EASE_IN_OUT_QUAD:o,EASE_OUT_IN_QUINT:h,EASE_IN_SIN:l,EASE_OUT_SIN:f,EASE_OUT_IN_SIN:d,EASE_IN_OUT_SIN:p}}(Math),RectangleMask=function(){"use strict";function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}return t}(),ScreenShaker=function(t,e,i){"use strict";function n(t){this.shaker={},this.device=t,this.__init()}function r(e,i,n,r){return 0==e||1==(e/=i)?0:t.floor(n*t.pow(2,-10*e)*t.sin(e*i*2*t.PI/r))}return n.prototype.__init=function(t){this.shaking=!1,this.smallShaking=!1,this.bigShaking=!1,this.time=0,this.duration=t?30:60,this.lastOffSetY=0,this.__150=i(this.device.height,480,150),this.__50=i(this.device.height,480,50),this.__25=i(this.device.height,480,25),this.__5=i(this.device.height,480,5)},n.prototype.startBigShake=function(){var t=this;this.shaking&&(this.smallShaking&&(this.smallShaking=!1),e.keys(this.shaker).forEach(function(e){var i=t.shaker[e];void 0!=i._startValueX&&(i.x=i._startValueX)}),this.bigShaking&&(e.keys(this.shaker).forEach(function(e){var i=t.shaker[e];i.y=i.y-t.lastOffSetY}),this.lastOffSetY=0)),this.shaking=!0,this.time=0,this.bigShaking=!0},n.prototype.startSmallShake=function(){var t=this;if(this.shaking){if(this.bigShaking)return;e.keys(this.shaker).forEach(function(e){var i=t.shaker[e];void 0!=i._startValueX&&(i.x=i._startValueX)})}this.shaking=!0,this.time=0,this.smallShaking=!0},n.prototype.update=function(){if(this.shaking){var t=this;if(this.smallShaking){var i=r(this.time,this.duration,this.__25,this.__5);e.keys(this.shaker).forEach(function(e){var n=t.shaker[e];(0==t.time||void 0==n._startValueX)&&(n._startValueX=n.x),0!=i?n.x=n._startValueX+i:n.x=n._startValueX})}else if(this.bigShaking){var n=this.__150,o=this.__5,a=r(this.time,this.duration,n-this.__50,o+this.__5),s=r(this.time,this.duration,n,o);e.keys(this.shaker).forEach(function(e){var i=t.shaker[e];(0==t.time||void 0==i._startValueX)&&(i._startValueX=i.x,t.lastOffSetY=0),0!=a?i.x=i._startValueX+a:i.x=i._startValueX,0!=s?i.y=i.y-t.lastOffSetY+s:i.y=i.y-t.lastOffSetY}),this.lastOffSetY=s}this.time++,this.time>=this.duration&&(this.time=0,this.shaking=!1,e.keys(this.shaker).forEach(function(e){var i=t.shaker[e];i.x=i._startValueX,delete i._startValueX,t.bigShaking&&(i.y=i.y-t.lastOffSetY,t.lastOffSetY=0)}),this.smallShaking=!1,this.bigShaking=!1)}},n.prototype.add=function(t){this.shaker[t.id]=t},n.prototype.remove=function(t){delete this.shaker[t.id]},n.prototype.resize=function(t){this.bigShaking=!1,this.smallShaking=!1,this.shaking=!1,this.time=0;var n=this;e.keys(this.shaker).forEach(function(t){var e=n.shaker[t];e._startValueX&&(e._startValueX=e.x)}),this.__150=i(t.height,480,150),this.__50=i(t.height,480,50),this.__25=i(t.height,480,25),this.__5=i(t.height,480,5)},n.prototype.reset=function(t){this.shaker={},this.__init(t)},n}(Math,Object,calcScreenConst),UniversalTranslator=function(t,e){"use strict";function i(i){this.locales=i,this.language=t?t.substring(0,2):"en",this.locales[this.language]||(this.language="en"),this.repo=new e}return i.prototype.setLanguage=function(t){this.language=t,this.repo.call(this)},i.prototype.getLanguages=function(){var t=[];return Object.keys(this.locales).forEach(function(e){t.push({language:e,name:this.locales[e].display_name})},this),t},i.prototype.get=function(t,e){return this.locales[this.language][t][e]},i.prototype.add=function(t,e,i,n){this.repo.add(t,function(t){e.msg=t.get(i,n)})},i.prototype.remove=function(t){this.repo.remove(t)},i.prototype.resetStorage=function(){this.repo=new e},i}(window.navigator.language||window.navigator.userLanguage,Repository),addFontToDOM=function(t){"use strict";return function(e){var i=t.createElement("style");i.type="text/css";var n="";e.forEach(function(t){n+="@font-face{",n+="font-family:"+t.name+";",n+="src:url("+t.url+")format('woff');",n+="} "}),i.innerHTML=n,t.head.appendChild(i)}}(document),requestAnimFrame=function(t){"use strict";return(t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)}).bind(t)}(window),lclStorage=function(t){"use strict";var e;try{e=t.localStorage}catch(i){e={dict:{},getItem:function(t){return this.dict[t]},setItem:function(t,e){this.dict[t]=e},clear:function(){this.dict={}}}}return e}(window),loadBoolean=function(t){"use strict";function e(e){return"true"==t.getItem(e)}return e}(lclStorage),loadInteger=function(t,e){"use strict";function i(i){var n=t.getItem(i);return null==n?0:e(n)}return i}(lclStorage,parseInt),loadString=function(t){"use strict";function e(e){var i=t.getItem(e);return null==i?"":i}return e}(lclStorage),loadObject=function(t,e){"use strict";function i(i){var n=t.getItem(i);return null==n?void 0:e.parse(n)}return i}(lclStorage,JSON),saveObject=function(t,e){"use strict";function i(i,n){t.setItem(i,e.stringify(n))}return i}(lclStorage,JSON),DeviceInfo=function(t,e){"use strict";function i(i,n,r,o){this.isFirefox=/firefox/i.test(i),this.isWiiU="wiiu"in t,this.isMobile=/mobile/i.test(i),this.width=e.floor(n*o),this.height=e.floor(r*o),this.cssWidth=n,this.cssHeight=r,this.devicePixelRatio=o}return i}(window,Math),FullScreenController=function(t,e){"use strict";function i(e){this.screen=e,this.isSupported=t.fullscreenEnabled||t.webkitFullscreenEnabled||t.mozFullScreenEnabled||t.msFullscreenEnabled}return i.prototype.request=function(){return this.screen.requestFullscreen?this.screen.requestFullscreen():this.screen.webkitRequestFullscreen?this.screen.webkitRequestFullscreen():this.screen.mozRequestFullScreen?this.screen.mozRequestFullScreen():this.screen.msRequestFullscreen&&this.screen.msRequestFullscreen(),this.isFullScreen()},i.prototype.isFullScreen=function(){return null!=(t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement||t.msFullscreenElement||e.standalone)},i.prototype.__isSupported=function(){return this.isSupported},i.prototype.exit=function(){return t.exitFullscreen?t.exitFullscreen():t.webkitExitFullscreen?t.webkitExitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen(),!this.isFullScreen()},i}(window.document,window.navigator),OrientationLock=function(t){"use strict";function e(e){return t?"orientation"in t&&"angle"in t.orientation?t.orientation.lock(e):t.lockOrientation?t.lockOrientation(e):t.msLockOrientation?t.msLockOrientation(e):t.mozLockOrientation?t.mozLockOrientation(e):!1:!1}function i(){return t?"orientation"in t&&"angle"in t.orientation?t.orientation.unlock():t.unlockOrientation?t.unlockOrientation():t.msUnlockOrientation?t.msUnlockOrientation():t.mozUnlockOrientation?t.mozUnlockOrientation():!1:!1}return{lock:e,unlock:i}}(window.screen),Touchable=function(){"use strict";function t(t,e,i,n,r){this.id=t,this.x=e,this.y=i,this.width=n,this.height=r}return t}(),Touchables=function(t){"use strict";function e(e){return new t(e.id+i,e.getCornerX(),e.getCornerY(),e.getWidth(),e.getHeight())}var i="_touch";return{get:e}}(Touchable),isHit=function(){"use strict";function t(t,e){return t.x>e.x&&t.x<e.x+e.width&&t.y>e.y&&t.y<e.y+e.height}return t}(),GamePad=function(t){"use strict";function e(t){this.index=t,this.lastUpdate=0}var i={A:0,B:1,X:2,Y:3,LEFT_BUMPER:4,RIGHT_BUMPER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,BACK:8,START:9,LEFT_STICK:10,RIGHT_STICK:11,D_PAD_UP:12,D_PAD_DOWN:13,D_PAD_LEFT:14,D_PAD_RIGHT:15,GUIDE:16},n={LEFT_STICK_X:0,LEFT_STICK_Y:1,RIGHT_STICK_X:2,RIGHT_STICK_Y:3};return e.prototype.update=function(){var e=t.getGamepads?t.getGamepads():t.webkitGetGamepads?t.webkitGetGamepads():[],i=e[this.index];return i?i.timestamp>this.lastUpdate?(this.buttons=i.buttons,this.axes=i.axes,this.lastUpdate=i.timestamp,!0):!1:void 0},e.prototype.getLeftStickXAxis=function(){return this.axes[n.LEFT_STICK_X]},e.prototype.getLeftStickYAxis=function(){return this.axes[n.LEFT_STICK_Y]},e.prototype.getRightStickXAxis=function(){return this.axes[n.RIGHT_STICK_X]},e.prototype.getRightStickYAxis=function(){return this.axes[n.RIGHT_STICK_Y]},e.prototype.isRightTriggerPressed=function(){return this.__isButtonPressed(i.RIGHT_TRIGGER)},e.prototype.isAPressed=function(){return this.__isButtonPressed(i.A)},e.prototype.isBPressed=function(){return this.__isButtonPressed(i.B)},e.prototype.isRightBumperPressed=function(){return this.__isButtonPressed(i.RIGHT_BUMPER)},e.prototype.isLeftBumperPressed=function(){return this.__isButtonPressed(i.LEFT_BUMPER)},e.prototype.isStartPressed=function(){return this.__isButtonPressed(i.START)},e.prototype.__isButtonPressed=function(t){return this.buttons[t].pressed},e}(navigator),Key={UP:38,DOWN:40,LEFT:37,RIGHT:39,ENTER:13,SPACE:32},WiiUGamePad=function(){"use strict";function t(t,e){this.gamepad=t,this.state=e}t.prototype.update=function(){return this.state=this.gamepad.update(),1==this.state.isEnabled&&1==this.state.isDataValid},t.prototype.__isButtonPressed=function(t){return this.state.hold&t?!0:!1},t.prototype.isAPressed=function(){return this.__isButtonPressed(e.A)};var e={CONTROL_PAD_UP:512,CONTROL_PAD_DOWN:256,CONTROL_PAD_LEFT:2048,CONTROL_PAD_RIGHT:1024,A:32768,B:16384,X:8192,Y:4096,L:32,R:16,ZL:128,ZR:64,MINUS:4,PLUS:8,L_STICK_UP:268435456,L_STICK_DOWN:134217728,L_STICK_LEFT:1073741824,L_STICK_RIGHT:536870912,R_STICK_UP:16777216,R_STICK_DOWN:8388608,R_STICK_LEFT:67108864,R_STICK_RIGHT:33554432,L_STICK:262144,R_STICK:131072};return t}(),WiiURemote=function(){"use strict";function t(t,e){this.remote=e,this.index=t}return t}(),OuyaGamePad=function(){"use strict";function t(t){this.index=t,this.buttons=e(),this.axes=i(),this.changed=!1}function e(){return{O:!1,U:!1,Y:!1,A:!1,L1:!1,R1:!1,L3:!1,R3:!1,D_PAD_UP:!1,D_PAD_DOWN:!1,D_PAD_RIGHT:!1,D_PAD_LEFT:!1,MENU:!1}}function i(){return{LS_X:0,LS_Y:0,RS_X:0,RS_Y:0,L2:0,R2:0}}return t.prototype.getLeftStickXAxis=function(){return this.axes.LS_X},t.prototype.getLeftStickYAxis=function(){return this.axes.LS_Y},t.prototype.getRightStickXAxis=function(){return this.axes.RS_X},t.prototype.getRightStickYAxis=function(){return this.axes.RS_Y},t.prototype.getRightTrigger=function(){
return this.axes.R2},t.prototype.isAPressed=function(){return this.buttons.O},t.prototype.isBPressed=function(){return this.buttons.A},t}(),KeyHandler=function(t){"use strict";function e(t){this.events=t,this.pressedKeys={},this.changed=!1}return e.prototype.keyDown=function(t){t.preventDefault(),this.pressedKeys[t.keyCode]=!0,this.changed=!0},e.prototype.keyUp=function(t){t.preventDefault(),delete this.pressedKeys[t.keyCode],this.changed=!0},e.prototype.update=function(){this.changed&&(this.events.fireSync(t.KEY_BOARD,this.pressedKeys),this.changed=!1)},e}(Event),GamePadHandler=function(t,e,i){"use strict";function n(t){this.events=t,this.gamePads=[]}return n.prototype.connect=function(e){this.gamePads.push(new t(e.gamepad.index))},n.prototype.detect=function(){for(var i=e.getGamepads?e.getGamepads():e.webkitGetGamepads?e.webkitGetGamepads():[],n=0;n<i.length;n++){var r=i[n];r&&this.gamePads.push(new t(r.index))}},n.prototype.shouldDetect=function(){return this.gamePads.length<1},n.prototype.disconnect=function(t){},n.prototype.update=function(){this.shouldDetect()&&this.detect();var t=this;this.gamePads.forEach(function(e){e.update()&&t.events.fireSync(i.GAME_PAD,e)})},n}(GamePad,navigator,Event),WiiUGamePadHandler=function(){"use strict";function t(t,e,i){this.events=t,this.gamePad=e,this.remotes=i}return t.prototype.update=function(){this.gamePad.update()&&this.events.fireSync(Event.GAME_PAD,this.gamePad)},t}(),OuyaGamePadHandler=function(t,e,i){"use strict";function n(e){this.events=e,this.gamePads={0:new t(0),1:new t(1),2:new t(2),3:new t(3)},this.changed=!1}function r(t,e,i){switch(t.changed=!0,e){case a.O:t.buttons.O=i;break;case a.U:t.buttons.U=i;break;case a.Y:t.buttons.Y=i;break;case a.A:t.buttons.A=i;break;case a.L1:t.buttons.L1=i;break;case a.R1:t.buttons.R1=i;break;case a.L3:t.buttons.L3=i;break;case a.R3:t.buttons.R3=i;break;case a.DPAD_UP:t.buttons.DPAD_UP=i;break;case a.DPAD_DOWN:t.buttons.DPAD_DOWN=i;break;case a.DPAD_RIGHT:t.buttons.DPAD_RIGHT=i;break;case a.DPAD_LEFT:t.buttons.DPAD_LEFT=i;break;case a.MENU:t.buttons.MENU=i}}n.prototype.update=function(){this.changed&&(i.keys(this.gamePads).forEach(function(t){t.changed&&(this.events.fireSync(e.GAME_PAD,t),t.changed=!1)},this),this.changed=!1)},n.prototype.keyDown=function(t,e){r(this.gamePads[t],e,!0),this.changed=!0},n.prototype.keyUp=function(t,e){r(this.gamePads[t],e,!1),this.changed=!0},n.prototype.genericMotionEvent=function(t,e,i){var n=this.gamePads[t];switch(n.changed=!0,e){case o.LS_X:n.axes.LS_X=i;break;case o.LS_Y:n.axes.LS_Y=i;break;case o.RS_X:n.axes.RS_X=i;break;case o.RS_Y:n.axes.RS_Y=i;break;case o.L2:n.axes.L2=i;break;case o.R2:n.axes.R2=i}this.changed=!0};var o={LS_X:0,LS_Y:1,RS_X:11,RS_Y:14,L2:17,R2:18},a={O:96,U:99,Y:100,A:97,L1:102,R1:103,L3:106,R3:107,DPAD_UP:19,DPAD_DOWN:20,DPAD_RIGHT:22,DPAD_LEFT:21,MENU:82};return n}(OuyaGamePad,Event,Object),PointerHandler=function(t,e,i){"use strict";function n(t,e){this.events=t,this.device=e,this.activePointers={},this.changed=!1,this.pendingDeletes=[]}var r={DOWN:"down",MOVE:"move",UP:"up"};return n.prototype.pointerDown=function(t){t.preventDefault(),this.activePointers[t.pointerId]={id:t.pointerId,x:t.clientX,y:t.clientY,changed:!0,type:r.DOWN},this.changed=!0},n.prototype.pointerMove=function(t){t.preventDefault();var e=this.activePointers[t.pointerId];e&&(e.x=t.clientX,e.y=t.clientY,e.changed=!0,e.type=r.MOVE,this.changed=!0)},n.prototype.pointerUp=function(t){t.preventDefault();var e=this.activePointers[t.pointerId];e&&(e.x=t.x,e.y=t.y,e.changed=!0,e.type=r.UP,this.changed=!0,this.pendingDeletes.push(e))},n.prototype.pointerCancel=function(t){this.pointerUp(t)},n.prototype.mouseDown=function(t){t.preventDefault(),this.activePointers.mouse={id:"mouse",x:t.clientX,y:t.clientY,changed:!0,type:r.DOWN},this.changed=!0},n.prototype.mouseMove=function(t){t.preventDefault();var e=this.activePointers.mouse;!e||e.type!=r.DOWN&&e.type!=r.MOVE||(e.x=t.clientX,e.y=t.clientY,e.changed=!0,e.type=r.MOVE,this.changed=!0)},n.prototype.mouseUp=function(t){t.preventDefault();var e=this.activePointers.mouse;e&&(e.x=t.x,e.y=t.y,e.changed=!0,e.type=r.UP,this.changed=!0,this.pendingDeletes.push(e))},n.prototype.mouseCancel=function(t){this.mouseUp(t)},n.prototype.touchStart=function(t){t.preventDefault();for(var e=t.changedTouches,i=0;i<e.length;i++)this.activePointers[e[i].identifier]={id:e[i].identifier,x:e[i].clientX,y:e[i].clientY,changed:!0,type:r.DOWN},this.changed=!0},n.prototype.touchMove=function(t){t.preventDefault();for(var e=t.changedTouches,i=0;i<e.length;i++){var n=e[i],o=this.activePointers[n.identifier];o.x=n.clientX,o.y=n.clientY,o.changed=!0,o.type=r.MOVE,this.changed=!0}},n.prototype.touchEnd=function(t){t.preventDefault();for(var e=t.changedTouches,i=0;i<e.length;i++){var n=e[i],o=this.activePointers[n.identifier];o.x=n.clientX,o.y=n.clientY,o.changed=!0,o.type=r.UP,this.changed=!0,this.pendingDeletes.push(o)}},n.prototype.touchCancel=function(t){this.touchEnd(t)},n.prototype.update=function(){for(this.changed&&(e.keys(this.activePointers).forEach(function(e){var n=this.activePointers[e];n.changed&&(this.device.screenScale&&(n.x=i.floor(n.x/this.device.screenScale),n.y=i.floor(n.y/this.device.screenScale)),this.device.devicePixelRatio>1&&(n.x=i.floor(n.x*this.device.devicePixelRatio),n.y=i.floor(n.y*this.device.devicePixelRatio)),this.events.fireSync(t.POINTER,n),n.changed=!1)},this),this.changed=!1),this.pendingDeletes.forEach(function(t){delete this.activePointers[t.id]},this);this.pendingDeletes.length>0;)this.pendingDeletes.pop()},n}(Event,Object,Math),TapManager=function(t,e,i){"use strict";function n(){this.elements={},this.disabled={}}return n.prototype.inputChanged=function(i){"move"!=i.type&&"up"!=i.type&&e(this.elements,function(e){return t(i,e.touchable)?(e.callback(),!0):!1},this)},n.prototype.add=function(t,e){this.elements[t.id]={touchable:t,callback:e}},n.prototype.remove=function(t){delete this.elements[t.id],delete this.disabled[t.id]},n.prototype.disable=function(t){this.disabled[t.id]=this.elements[t.id],delete this.elements[t.id]},n.prototype.disableAll=function(){i(this.elements,function(t,e){this.disabled[e]=t,delete this.elements[e]},this)},n.prototype.enable=function(t){this.elements[t.id]=this.disabled[t.id],delete this.disabled[t.id]},n.prototype.enableAll=function(){i(this.disabled,function(t,e){this.elements[e]=t,delete this.disabled[e]},this)},n}(isHit,iterateSomeEntries,iterateEntries),measureText=function(t){"use strict";function e(t){(t.alpha||0===t.alpha)&&(n.globalAlpha=t.alpha),n.textBaseline="middle",n.textAlign="center",n.fillStyle=t.color,n.font=t.size+"px "+t.fontFamily;var e=n.measureText(t.msg);return{width:e.width,height:t.size}}var i=t.createElement("canvas"),n=i.getContext("2d");return e}(window.document),SubImage=function(){"use strict";function t(t,e,i,n,r,o,a,s,c,u,h,d,l){this.x=t,this.y=e,this.width=i,this.height=n,this.offSetX=r,this.offSetY=o,this.trimmedWidth=a,this.trimmedHeight=s,this.scaledOffSetX=c,this.scaledOffSetY=u,this.scaledTrimmedWidth=h,this.scaledTrimmedHeight=d,this.img=l}return t}(),ImageWrapper=function(){"use strict";function t(t,e,i,n){this.img=t,this.width=e,this.height=i,this.scale=n}return t}(),TextWrapper=function(){"use strict";function t(t,e,i,n,r,o){this.msg=t,this.size=e,this.fontFamily=i,this.color=n,this.maxLineLength=r,this.lineHeight=o}return t}(),Rectangle=function(){"use strict";function t(t,e,i,n,r){this.width=t,this.height=e,this.color=i,this.filled=void 0!==n?n:!1,this.lineWidth=r}return t}(),Circle=function(){"use strict";function t(t,e,i,n){this.radius=t,this.color=e,this.filled=void 0!==i?i:!1,this.lineWidth=n}return t}(),EquilateralTriangle=function(){"use strict";function t(t,e,i,n,r){this.angle=t,this.radius=e,this.color=i,this.filled=void 0!==n?n:!1,this.lineWidth=r}return t}(),DrawableLine=function(){"use strict";function t(t,e,i){this.length=t,this.color=e,this.lineWidth=i}return t}(),Drawable=function(t,e,i,n,r,o,a){"use strict";function s(t,e,i,n,r,o,a,s){this.id=t,this.x=e,this.y=i,this.data=n,this.zIndex=void 0===r?3:r,this.rotation=a,this.alpha=o,this.scale=s||1,this.rotationAnchorOffsetX=0,this.rotationAnchorOffsetY=0,this.anchorOffsetX=0,this.anchorOffsetY=0,this.show=!0,this.flipHorizontally=!1,this.flipVertically=!1}return s.prototype.getRotationAnchorX=function(){return this.x+this.rotationAnchorOffsetX},s.prototype.getRotationAnchorY=function(){return this.y+this.rotationAnchorOffsetY},s.prototype.getAnchorX=function(){return this.x+this.anchorOffsetX},s.prototype.getAnchorY=function(){return this.y+this.anchorOffsetY},s.prototype.getCornerX=function(){return this.x-this.getWidthHalf()},s.prototype.getCornerY=function(){return this.y-this.getHeightHalf()},s.prototype.getEndX=function(){return this.x+this.getWidthHalf()},s.prototype.getEndY=function(){return this.y+this.getHeightHalf()},s.prototype.getWidth=function(){return t.floor(this.__getWidth()*this.scale)},s.prototype.getWidthHalf=function(){return t.floor(this.__getWidth()/2*this.scale)},s.prototype.getHeightHalf=function(){return t.floor(this.__getHeight()/2*this.scale)},s.prototype.getHeight=function(){return t.floor(this.__getHeight()*this.scale)},s.prototype.__getHeight=function(){return this.data instanceof i?this.data.size:this.data instanceof n?this.data.scaledTrimmedHeight:this.data instanceof r?this.data.height*this.data.scale:this.data instanceof a?0:this.data instanceof o?2*this.data.radius:this.data.height},s.prototype.__getWidth=function(){return this.data instanceof i?e(this.data).width:this.data instanceof n?this.data.scaledTrimmedWidth:this.data instanceof r?this.data.width*this.data.scale:this.data instanceof a?this.data.length:this.data instanceof o?2*this.data.radius:this.data.width},s}(Math,measureText,TextWrapper,SubImage,ImageWrapper,Circle,DrawableLine),Drawables=function(t,e,i,n,r,o){"use strict";function a(e,i,n,r,o,a,s,c,u){var h=e.get(o);return new t(o+i,n,r,h,a,s,c,u)}function s(i,n,r,o,a,s,u,h,d,l,f,p,g){var m=new e(a,s,u,h,f,p);return new t(c(n.toString()+r+a+s)+i,n,r,m,o,l,d,g)}function c(t){return t.split("").reduce(function(t,e){return t=(t<<5)-t+e.charCodeAt(0),t&t},0)}function u(e,n,r,o,a,s,u,h,d,l,f,p){var g=new i(o,a,s,u,h);return new t(c(n.toString()+r+o+a+s+u)+e,n,r,g,d,l,f,p)}function h(t,e,i,r){return new n(t,e,i,r)}function d(e,i,n,o,a,s,u,h,d,l,f){var p=new r(o,a,s,u);return new t(c(i.toString()+n+o+a+s)+e,i,n,p,h,d,l,f)}function l(e,i,n,r,a,s,u,h,d,l){var f=new o(r,a,s);return new t(c(i.toString()+n+r+a)+e,i,n,f,u,h,d,l)}function f(e,i,n,r,o,a,s,u,h,d,l,f){var p=new EquilateralTriangle(r,o,a,s,u);return new t(c(i.toString()+n+r+o+a+s)+e,i,n,p,h,d,l,f)}return{getGraphic:a,getTxt:s,getRect:u,getMask:h,getCircle:d,getLine:l,getEqTriangle:f}}(Drawable,TextWrapper,Rectangle,RectangleMask,Circle,DrawableLine,EquilateralTriangle),Animation=function(){"use strict";function t(t,e,i,n,r,o){this.start=t,this.end=e,this.length=i,this.duration=n,this.timingFn=r,this.loop=void 0!==o?o:!1}return t}(),Animations=function(t,e){"use strict";function i(i,n,r,o,a){var s=e.abs(i-n);return i>n&&(s=-s),new t(i,n,s,r,o,a)}return{get:i}}(Animation,Math),Paths=function(t,e,i,n,r,o){"use strict";function a(t,i,n,a,s,c,u){var h=r.get(t,i,n,a),d=r.magnitude(h.x,h.y),l=r.normalize(h.x,h.y),f=new e(t,i,n,a,h.x,h.y,l.x,l.y,d),p=o.get(0,1,s,c,u);return p.curve=f,p}function s(t,e,n,r,a,s,c,u){var h=new i(t,e,n,r,a),d=o.get(r,a,s,c,u);return d.curve=h,d}function c(t,e,i,r,a,s,c,u,h,d,l){var f=new n(t,e,i,r,a,s,c,u),p=o.get(0,1,h,d,l);return p.curve=f,p}return{getLine:a,getCurve:c,getCircle:s}}(Math,LinePath,CirclePath,BezierCurvePath,Vectors,Animations),Sprite=function(){"use strict";function t(t,e){this.frames=t,this.loop=void 0!==e?e:!0}return t}(),Sprites=function(t){"use strict";function e(e,i,n,r){for(var o=[],a=0;n>a;a++)o.push(10>a?e.get(i+"_000"+a):e.get(i+"_00"+a));return new t(o,r)}return{get:e}}(Sprite),CanvasImageCollisionDetector=function(t){"use strict";function e(e){this.drawable=e;var i=t.createElement("canvas");this.ctx=i.getContext("2d"),i.width=this.width=e.getWidth(),i.height=this.height=e.getHeight()}return e.prototype.isHit=function(t){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.drawable.data.img,0,0,this.drawable.getWidth(),this.drawable.getHeight()),this.ctx.save(),this.ctx.globalCompositeOperation="source-in";var e=t.getCornerX()-this.drawable.getCornerX(),i=t.getCornerY()-this.drawable.getCornerY();this.ctx.drawImage(t.data.img,e,i,t.getWidth(),t.getHeight()),this.ctx.restore();var n=e+t.getWidth(),r=i+t.getHeight();if(1>n||1>r)return!1;for(var o=this.ctx.getImageData(0,0,n,r).data,a=0;a<o.length;a+=4){var s=o[a+3];if(0!=s)return!0}return!1},e.prototype.resize=function(){this.ctx.canvas.width=this.width=this.drawable.getWidth(),this.ctx.canvas.height=this.height=this.drawable.getHeight()},e}(window.document),BasicAnimations=function(t,e){"use strict";function i(){this.dict={},this.paused={}}return i.prototype.animate=function(t,e,i,n){var r=void 0!==this.dict[t.id],o=void 0!==this.paused[t.id];r?this.dict[t.id].push({setter:e,animation:i,callback:n,time:0,active:!0}):o?this.paused[t.id].push({setter:e,animation:i,callback:n,time:0,active:!0}):this.dict[t.id]=[{setter:e,animation:i,callback:n,time:0,active:!0}]},i.prototype.update=function(){t.keys(this.dict).forEach(function(t){var e=this.dict[t];if(e){for(var i=e.length-1;i>=0;i--){var n=e[i],r=n.animation;if(r.duration>n.time){var o=r.timingFn(n.time,r.start,r.length,r.duration);n.setter(o,n.time),n.time++}else n.setter(r.end,n.time),r.loop?n.time=0:e.splice(i,1),n.callback&&n.callback()}0==e.length&&delete this.dict[t]}},this)},i.prototype.remove=function(t){delete this.dict[t.id],delete this.paused[t.id]},i.prototype.has=function(t){return void 0!==this.dict[t.id]||void 0!==this.paused[t.id]},i.prototype.pause=function(t){this.paused[t.id]=this.dict[t.id],delete this.dict[t.id]},i.prototype.pauseAll=function(){e(this.dict,function(t,e){this.paused[e]=t,delete this.dict[e]},this)},i.prototype.play=function(t){this.dict[t.id]=this.paused[t.id],delete this.paused[t.id]},i.prototype.playAll=function(){e(this.paused,function(t,e){this.dict[e]=t,delete this.paused[e]},this)},i}(Object,iterateEntries),AnimationHelper=function(){"use strict";function t(t){this.animations=t}return t.prototype.animateWithKeyFrames=function(t,e){function i(t,o){var a;a=o.length>0?t.callback?function(){t.callback(),i(o.shift(),o)}:function(){i(o.shift(),o)}:e?t.callback?function(){t.callback(),r.animateWithKeyFrames(n,e)}:function(){r.animateWithKeyFrames(n,e)}:t.callback,r.animations.animate(t.drawable,t.setter,t.animation,a)}if(e)var n=t.slice();var r=this;i(t.shift(),t)},t}(),AnimationTimer=function(){"use strict";function t(t,e){this.animations=t,this.timer=e}return t.prototype.animateLater=function(t,e,i){var n=this;this.timer.doLater(function(){n.animations.animate(t.drawable,t.setter,t.animation,t.callback),i&&i()},e)},t}(),PropertyAnimations=function(t){"use strict";function e(t,e){this.animations=t,this.animationHelper=e}return e.prototype.animateAlpha=function(t,e,i,n,r,o){return this.__animateProperty(t,"alpha",e,i,n,r,o)},e.prototype.animateAlphaPattern=function(t,e,i){return this.__animatePropertyPattern(t,"alpha",e,i)},e.prototype.animateRotation=function(t,e,i,n,r,o){return this.__animateProperty(t,"rotation",e,i,n,r,o)},e.prototype.animateRotationPattern=function(t,e,i){return this.__animatePropertyPattern(t,"rotation",e,i)},e.prototype.animateScale=function(t,e,i,n,r,o){return this.__animateProperty(t,"scale",e,i,n,r,o)},e.prototype.animateScalePattern=function(t,e,i){return this.__animatePropertyPattern(t,"scale",e,i)},e.prototype.__animateProperty=function(e,i,n,r,o,a,s){var c=t.get(e[i],n,r,o,a);return this.animations.animate(e,function(t){e[i]=t},c,s),c},e.prototype.__animatePropertyPattern=function(e,i,n,r){for(var o=[],a=function(t){e[i]=t},s=e[i]||0,c=0;c<n.length;c++){var u=n[c];o.push({drawable:e,setter:a,animation:t.get(s,u.value,u.duration,u.easing,!1),callback:u.callback}),s=u.value}this.animationHelper.animateWithKeyFrames(o,r)},e}(Animations),SpriteAnimations=function(t,e){"use strict";function i(){this.animationsDict={},this.paused={},this.ticker=0,this.is30fps=!1}return i.prototype.set30fps=function(t){this.is30fps=void 0!==t?t:!0},i.prototype.animate=function(t,e,i){t.data=e.frames[0],this.animationsDict[t.id]={drawable:t,sprite:e,callback:i,time:0}},i.prototype.nextFrame=function(){t.keys(this.animationsDict).forEach(function(t){var e=this.animationsDict[t],i=e.drawable,n=e.sprite;i.data=n.frames[++e.time],e.time>=n.frames.length&&(n.loop?(e.time=0,i.data=n.frames[0]):delete this.animationsDict[t],e.callback&&e.callback())},this)},i.prototype.update=function(){(this.is30fps||this.ticker%2===0)&&(this.nextFrame(),this.ticker=0),this.ticker++},i.prototype.remove=function(t){delete this.animationsDict[t.id],delete this.paused[t.id]},i.prototype.has=function(t){return void 0!==this.animationsDict[t.id]||void 0!==this.paused[t.id]},i.prototype.pause=function(t){this.paused[t.id]=this.animationsDict[t.id],delete this.animationsDict[t.id]},i.prototype.pauseAll=function(){e(this.animationsDict,function(t,e){this.paused[e]=t,delete this.animationsDict[e]},this)},i.prototype.play=function(t){this.animationsDict[t.id]=this.paused[t.id],delete this.paused[t.id]},i.prototype.playAll=function(){e(this.paused,function(t,e){this.animationsDict[e]=t,delete this.paused[e]},this)},i}(Object,iterateEntries),SpriteTimer=function(){"use strict";function t(t,e){this.spriteAnimations=t,this.timer=e}return t.prototype.animateLater=function(t,e,i){var n=this;this.timer.doLater(function(){n.spriteAnimations.animate(t.drawable,t.sprite,t.callback),i&&i()},e)},t}(),inheritMethods=function(t){"use strict";function e(e,i,n){for(var r in e)e.hasOwnProperty(r)||!function(r){var o=t.getOwnPropertyNames(n).some(function(t){return t==r});o||(i[r]=e[r].bind(e))}(r)}return e}(Object),MotionHelper=function(){"use strict";function t(t){this.motions=t}return t.prototype.moveRoundTrip=function(t,e,i,n,r,o){function a(){r?u.motions.animate(t,e,function(){r(),c()}):u.motions.animate(t,e,c)}function s(){u.motions.has(t)&&a()}function c(){u.motions.has(t)&&(n?o?u.motions.animate(t,i,function(){o(),s()}):u.motions.animate(t,i,s):o?u.motions.animate(t,i,o):u.motions.animate(t,i))}var u=this;a()},t}(),MotionTimer=function(){"use strict";function t(t,e){this.motions=t,this.timer=e}return t.prototype.moveLater=function(t,e,i){var n=this;this.timer.doLater(function(){n.motions.move(t.drawable,t.path,t.callback),i&&i()},e)},t}(),calcLinePoint=function(){"use strict";function t(t,e){var i=e.startX+t*e.vectorX,n=e.startY+t*e.vectorY;return{x:i,y:n}}return t}(),calcCirclePoint=function(t){"use strict";function e(e,i){return{x:t.getX(i.x,i.radius,e),y:t.getY(i.y,i.radius,e)}}return e}(Vectors),calcBezierPoint=function(){"use strict";function t(t,e){function i(e,i,c,u){return a*e+3*o*t*i+3*n*r*c+s*u}var n=1-t,r=t*t,o=n*n,a=o*n,s=r*t;return{x:i(e.pointA_x,e.pointB_x,e.pointC_x,e.pointD_x),y:i(e.pointA_y,e.pointB_y,e.pointC_y,e.pointD_y)}}return t}(),Motions=function(t,e,i,n,r,o,a,s,c){"use strict";function u(t){this.animations=t,o(t,this,u.prototype)}return u.prototype.animate=function(r,o,u){var h;o.curve instanceof e?h=i:o.curve instanceof a?h=c:o.curve instanceof s&&(h=n),this.animations.animate(r,function(e){var i=h(e,o.curve);r.x=t.floor(i.x),r.y=t.floor(i.y)},o,u)},u}(Math,LinePath,calcLinePoint,calcBezierPoint,Animations,inheritMethods,CirclePath,BezierCurvePath,calcCirclePoint),wrapText=function(){"use strict";function t(t,e,i,n,r,o){for(var a=e.split(" "),s="",c=[],u=0;u<a.length;u++){var h=s+a[u]+" ",d=t.measureText(h),l=d.width;l>r&&u>0?(c.push(s),s=a[u]+" "):s=h}c.push(s);for(var f=c.length*o/2,p=n-Math.floor(f/2),g=0;g<c.length;g++)t.fillText(c[g],i,p),p+=o}return t}(),renderPolygon=function(t){"use strict";function e(e,i,n,r,o,a){var s=2*t.PI/o,c=!1;s=c?-s:s;var u;u=a?r.radius*a+1:r.radius+1,e.beginPath(),e.translate(i,n),e.rotate(r.angle),e.moveTo(u,0);for(var h=1;o>h;h++)e.lineTo(u*t.cos(s*h),u*t.sin(s*h));e.closePath(),r.filled?(e.fillStyle=r.color,e.fill()):(e.strokeStyle=r.color,e.lineWidth=r.lineWidth,e.stroke())}return e}(Math),renderEqTriangle=function(t){"use strict";function e(e,i){t(e,i.x,i.y,i.data,3,i.scale)}return e}(renderPolygon),renderImage=function(){"use strict";function t(t,e){t.drawImage(e.data.img,e.getCornerX(),e.getCornerY(),e.getWidth(),e.getHeight())}return t}(),renderAtlas=function(){"use strict";function t(t,e){1!=e.scale?t.drawImage(e.data.img,e.data.x,e.data.y,e.data.width,e.data.height,e.getCornerX(),e.getCornerY(),e.getWidth(),e.getHeight()):t.drawImage(e.data.img,e.data.x,e.data.y,e.data.width,e.data.height,e.x+e.data.scaledOffSetX,e.y+e.data.scaledOffSetY,e.data.scaledTrimmedWidth,e.data.scaledTrimmedHeight)}return t}(),renderText=function(t,e){"use strict";function i(i,n){i.textBaseline="middle",i.textAlign="center",i.fillStyle=n.data.color,i.font=e.floor(n.data.size*n.scale)+"px "+n.data.fontFamily;var r=n.data.maxLineLength&&i.measureText(n.data.msg).width>n.data.maxLineLength;r?t(i,n.data.msg,n.x,n.y,n.data.maxLineLength,n.data.lineHeight):i.fillText(n.data.msg,n.x,n.y)}return i}(wrapText,Math),renderCircle=function(t){"use strict";function e(e,i){e.beginPath(),e.arc(i.x,i.y,i.data.radius,0,2*t.PI),e.closePath(),i.data.lineWidth&&(e.lineWidth=i.data.lineWidth),i.data.filled?(e.fillStyle=i.data.color,e.fill()):(e.strokeStyle=i.data.color,e.stroke())}return e}(Math),renderCurve=function(){"use strict";function t(t,e){t.beginPath(),t.moveTo(e.data.xPointA,e.data.yPointA),t.bezierCurveTo(e.data.xPointB,e.data.yPointB,e.data.xPointC,e.data.yPointC,e.data.xPointD,e.data.yPointD),t.closePath(),t.stroke()}return t}(),renderHexagon=function(t,e){"use strict";function i(e,i){t(e,i.x,i.y,i.data,6)}return i}(renderPolygon,Math),renderLine=function(){"use strict";function t(t,e){t.beginPath(),t.moveTo(e.getCornerX(),e.getCornerY()),t.lineTo(e.getEndX(),e.getEndY()),t.closePath(),t.strokeStyle=e.data.color,e.data.lineWidth&&(t.lineWidth=e.data.lineWidth),t.stroke()}return t}(),renderRectangle=function(){"use strict";function t(t,e){e.data.filled?(t.fillStyle=e.data.color,e.flipHorizontally?t.fillRect(-1*(e.getCornerX()-.5),e.getCornerY()-.5,e.getWidth(),e.getHeight()):t.fillRect(e.getCornerX()-.5,e.getCornerY()-.5,e.getWidth(),e.getHeight())):(t.strokeStyle=e.data.color,e.data.lineWidth&&(t.lineWidth=e.data.lineWidth),e.flipHorizontally?t.strokeRect(-1*(e.getCornerX()-.5),e.getCornerY()-.5,e.getWidth(),e.getHeight()):t.strokeRect(e.getCornerX()-.5,e.getCornerY()-.5,e.getWidth(),e.getHeight()))}return t}(),Renderer=function(t,e,i,n,r,o,a,s,c,u,h,d,l,f,p,g){"use strict";function m(t){this.screen=t,this.ctx=t.getContext("2d"),this.screenWidth=t.width,this.screenHeight=t.height,this.drawableDict=[{},{},{},{},{},{},{},{},{},{},{},{}],this.renderServices={}}return m.prototype.resize=function(t){t.devicePixelRatio>1?(this.screen.style.width=t.cssWidth+"px",this.screen.style.height=t.cssHeight+"px",this.screen.width=this.screenWidth=t.width,this.screen.height=this.screenHeight=t.height):(this.screen.width=this.screenWidth=t.width,this.screen.height=this.screenHeight=t.height)},m.prototype.add=function(t){this.drawableDict[t.zIndex][t.id]=t},m.prototype.remove=function(t){delete this.drawableDict[t.zIndex][t.id]},m.prototype.has=function(t){return void 0!==this.drawableDict[t.zIndex][t.id]},m.prototype.draw=function(){function e(e){t.keys(e).forEach(function(t){var v=e[t];v.show&&(m.ctx.save(),v.mask&&(m.ctx.beginPath(),m.ctx.rect(v.mask.x,v.mask.y,v.mask.width,v.mask.height),m.ctx.closePath(),m.ctx.clip()),(v.alpha||0===v.alpha)&&(m.ctx.globalAlpha=v.alpha),v.flipHorizontally?(m.ctx.translate(v.getWidth(),0),m.ctx.scale(-1,1),v.rotation&&(m.ctx.translate(-v.getRotationAnchorX(),v.getRotationAnchorY()),m.ctx.rotate(v.rotation),m.ctx.translate(v.getRotationAnchorX(),-v.getRotationAnchorY()))):v.rotation&&(m.ctx.translate(v.getRotationAnchorX(),v.getRotationAnchorY()),m.ctx.rotate(v.rotation),m.ctx.translate(-v.getRotationAnchorX(),-v.getRotationAnchorY())),m.ctx.translate(v.anchorOffsetX,v.anchorOffsetY),v.data instanceof p?g(m.ctx,v):v.data instanceof i?n(m.ctx,v):v.data instanceof r?o(m.ctx,v):v.data instanceof a?s(m.ctx,v):v.data instanceof c?u(m.ctx,v):v.data instanceof h?d(m.ctx,v):v.data instanceof l&&f(m.ctx,v),m.ctx.restore())})}var m=this;this.ctx.clearRect(0,0,this.screenWidth,this.screenHeight),t.keys(m.drawableDict).forEach(function(t){e(m.drawableDict[t])})},m.prototype.registerRenderer=function(t,i){if(t.constructor.name)this.renderServices[t.constructor.name]=i;else{var n=e(t.constructor);this.renderServices[n]=i,t.constructor.name=n}},m}(Object,getFunctionName,SubImage,renderAtlas,TextWrapper,renderText,Rectangle,renderRectangle,DrawableLine,renderLine,Circle,renderCircle,ImageWrapper,renderImage,EquilateralTriangle,renderEqTriangle),CallbackTimer=function(){"use strict";function t(){this.todos=[]}return t.prototype.update=function(){if(0!=this.todos.length)for(var t=this.todos.length-1;t>=0;t--){var e=this.todos[t];e&&(e.duration<e.time?(e.callback(),this.todos.splice(t,1)):e.time++)}},t.prototype.doLater=function(t,e){this.todos.push({duration:e,time:0,callback:t})},t.prototype.pause=function(){this.paused?this.paused.push.apply(this.paused,this.todos.splice(0,this.todos.length)):this.paused=this.todos.splice(0,this.todos.length)},t.prototype.resume=function(){this.todos.push.apply(this.todos,this.paused),delete this.paused},t}(),Stage=function(t,e,i,n,r){"use strict";function o(t,e,i,n,r,o,a,s,c,u,h,d){this.gfxCache=t,this.motions=e,this.motionTimer=i,this.motionHelper=n,this.spriteTimer=o,this.spriteAnimations=r,this.animations=a,this.animationHelper=s,this.animationTimer=c,this.propertyAnimations=u,this.renderer=h,this.timer=d,this._id=0}return o.prototype.getImageWidth=function(t){return r.floor(this.gfxCache.get(t).width*this.gfxCache.defaultScaleFactor)},o.prototype.getImageHeight=function(t){return r.floor(this.gfxCache.get(t).height*this.gfxCache.defaultScaleFactor)},o.prototype.getDrawable=function(t,i,n,r,o,a,s){return e.getGraphic(this.gfxCache,++this._id,t,i,n,r,o,a,s)},o.prototype.getDrawableText=function(t,i,n,r,o,a,s,c,u,h,d,l){return e.getTxt(++this._id,t,i,n,r,o,a,s,c,u,h,d,l)},o.prototype.getDrawableRectangle=function(t,i,n,r,o,a,s,c,u,h,d){return e.getRect(++this._id,t,i,n,r,o,a,s,c,u,h,d)},o.prototype.getSprite=function(e,i,n){return t.get(this.gfxCache,e,i,n)},o.prototype.getPath=function(t,e,n,r,o,a,s){return i.getLine(t,e,n,r,o,a,s)},o.prototype.getGraphic=function(t){return this.gfxCache.get(t)},o.prototype.animateFresh=function(t,e,i,n,r,o,a,s,c){var u=this.getSprite(i,n,r),h=this.getDrawable(t,e,i,o,a,s,c);return this.animate(h,u),{drawable:h,sprite:u}},o.prototype.animate=function(t,e,i){this.spriteAnimations.animate(t,e,i),this.__softAdd(t)},o.prototype.__softAdd=function(t){this.renderer.has(t)||this.renderer.add(t)},o.prototype.animateLater=function(t,e,i){var n;if(this.renderer.has(t.drawable))n=i;else{var r=this;n=function(){r.renderer.add(t.drawable),i&&i()}}this.spriteTimer.animateLater(t,e,n)},o.prototype.moveFresh=function(t,e,i,n,r,o,a,s,c,u,h,d,l){var f=this.getDrawable(t,e,i,u,h,d,l),p=this.getPath(t,e,n,r,o,a,s);return this.move(f,p,c),{drawable:f,path:p}},o.prototype.moveFreshText=function(t,e,i,n,r,o,a,s,c,u,h,d,l,f,p,g,m){var v=this.getDrawableText(t,e,l,i,n,r,o,p,f,g,m),y=this.getPath(t,e,a,s,c,u,h);return this.move(v,y,d),{drawable:v,path:y}},o.prototype.moveFreshRoundTrip=function(t,e,i,n,r,o,a,s,c,u,h,d,l,f){var p=this.getDrawable(t,e,i,h,d,l,f),g=this.getPath(t,e,n,r,o,a),m=this.getPath(n,r,t,e,o,a);return this.moveRoundTrip(p,g,m,s,c,u),{drawable:p,pathTo:g,pathReturn:m}},o.prototype.moveFreshLater=function(t,e,i,n,r,o,a,s,c,u,h,d,l,f,p){var g=this.getDrawable(t,e,i,d,l,f,p),m=this.getPath(t,e,n,r,o,a,c),v={drawable:g,path:m,callback:u};return this.moveLater(v,s,h),{drawable:g,path:m}},o.prototype.move=function(t,e,i){this.motions.animate(t,e,i),this.__softAdd(t)},o.prototype.moveCircular=function(t,e,n,r,o,a,s,c,u,h){var d=i.getCircle(e,n,r,o,a,s,c,u);return this.motions.animate(t,d,h),this.__softAdd(t),d},o.prototype.moveRoundTrip=function(t,e,i,n,r,o){this.motionHelper.moveRoundTrip(t,e,i,n,r,o),this.__softAdd(t)},o.prototype.moveLater=function(t,e,i){var n;if(this.renderer.has(t.drawable))n=i;else{var r=this;n=function(){r.renderer.add(t.drawable),i&&i()}}this.motionTimer.moveLater(t,e,n)},o.prototype.drawFresh=function(t,e,i,n,r,o,a){var s=this.getDrawable(t,e,i,n,r,o,a);return this.draw(s),s},o.prototype.draw=function(t){this.renderer.add(t)},o.prototype.drawText=function(t,e,i,n,r,o,a,s,c,u,h,d){var l=this.getDrawableText(t,e,a,i,n,r,o,s,c,u,h,d);return this.draw(l),l},o.prototype.drawRectangle=function(t,e,i,n,r,o,a,s,c,u,h){var d=this.getDrawableRectangle(t,e,i,n,r,o,a,s,c,u,h);return this.draw(d),d},o.prototype.drawCircle=function(t,i,n,r,o,a,s,c,u,h){var d=e.getCircle(++this._id,t,i,n,r,o,a,s,c,u,h);return this.draw(d),d},o.prototype.drawLine=function(t,i,n,r,o,a,s,c,u){var h=e.getLine(++this._id,t,i,n,r,o,a,s,c,u);return this.draw(h),h},o.prototype.drawEqTriangle=function(t,i,n,r,o,a,s,c,u,h,d){var l=e.getEqTriangle(++this._id,t,i,n,r,o,a,s,c,u,h,d);return this.draw(l),l},o.prototype.animateAlpha=function(t,e,i,n,r,o){return this.propertyAnimations.animateAlpha(t,e,i,n,r,o)},o.prototype.animateAlphaPattern=function(t,e,i){this.propertyAnimations.animateAlphaPattern(t,e,i)},o.prototype.animateRotation=function(t,e,i,n,r,o){return this.propertyAnimations.animateRotation(t,e,i,n,r,o)},o.prototype.animateRotationPattern=function(t,e,i){this.propertyAnimations.animateRotationPattern(t,e,i)},o.prototype.animateScale=function(t,e,i,n,r,o){return this.propertyAnimations.animateScale(t,e,i,n,r,o)},o.prototype.animateScalePattern=function(t,e,i){this.propertyAnimations.animateScalePattern(t,e,i)},o.prototype.mask=function(t,i,n,r,o){return t.mask=e.getMask(i,n,r-i,o-n),t.mask},o.prototype.unmask=function(t){delete t.mask},o.prototype.basicAnimation=function(t,e,i,n){this.animations.animate(t,e,i,n)},o.prototype.basicAnimationLater=function(t,e,i){this.animationTimer.animateLater(t,e,i)},o.prototype.basicAnimationPattern=function(t,e){this.animationHelper.animateWithKeyFrames(t,e)},o.prototype.getAnimation=function(t,e,i,r,o){return n.get(t,e,i,r,o)},o.prototype.remove=function(t){this.spriteAnimations.has(t)&&this.spriteAnimations.remove(t),this.animations.has(t)&&this.animations.remove(t),this.motions.has(t)&&this.motions.remove(t),this.renderer.has(t)&&this.renderer.remove(t)},o.prototype.has=function(t){return this.renderer.has(t)||this.motions.has(t)||this.spriteAnimations.has(t)||this.animations.has(t)},o.prototype.update=function(){this.timer.update(),this.motions.update(),this.spriteAnimations.update(),this.animations.update(),this.renderer.draw()},o.prototype.resize=function(t){this.renderer.resize(t)},o.prototype.pause=function(t){this.motions.has(t)&&this.motions.pause(t),this.animations.has(t)&&this.animations.pause(t),this.spriteAnimations.has(t)&&this.spriteAnimations.pause(t)},o.prototype.play=function(t){this.motions.has(t)&&this.motions.play(t),this.animations.has(t)&&this.animations.play(t),this.spriteAnimations.has(t)&&this.spriteAnimations.play(t)},o.prototype.pauseAll=function(){this.motions.pauseAll(),this.animations.pauseAll(),this.spriteAnimations.pauseAll()},o.prototype.playAll=function(){this.motions.playAll(),this.animations.playAll(),this.spriteAnimations.playAll()},o}(Sprites,Drawables,Paths,Animations,Math),ResizableStage=function(t,e,i,n,r,o,a,s,c,u,h){"use strict";function d(t,e,i,r,o,a,s,c){this.stage=t,this.gfx=e,this.resizer=i,this.createInput=r,this.changeInput=o,this.width=a,this.height=s,this.timer=c,this.collisions={},n(t,this,d.prototype)}d.prototype.getCollisionDetector=function(t){var e=new i(t);
return this.collisions[t.id]=e,e},d.prototype.detachCollisionDetector=function(t){delete this.collisions[t.drawable.id]},d.prototype.drawFresh=function(e,i,n,r,o,a,s,c){var u=this.stage.drawFresh(e(this.width,this.height),i(this.height,this.width),n,r,a,s,c);return this.resizer.add(u,function(n,r){t(u,e(n,r),i(r))},o),u},d.prototype.drawFreshWithInput=function(e,i,n,r,o,a,s,c){var u=this.stage.drawFresh(e(this.width,this.height),i(this.height,this.width),n,r,a,s,c),h=this,d=h.createInput(u);return this.resizer.add(u,function(n,r){t(u,e(n,r),i(r)),h.changeInput(d,u)},o),{drawable:u,input:d}},d.prototype.drawText=function(e,i,n,r,o,a,s,c,u,h,d,l,f){var p=this.stage.drawText(e(this.width,this.height),i(this.height,this.width),n,r(this.width,this.height),o,a,s,u,h,d?d(this.width,this.height):void 0,l?l(this.height,this.width):void 0,f);return this.resizer.add(p,function(n,o){t(p,e(n,o),i(o)),p.data.size=r(n,o),d&&(p.data.maxLineLength=d(n,o)),l&&(p.data.lineHeight=l(o,n))},c),p},d.prototype.drawTextWithInput=function(e,i,n,r,o,a,s,c,u,h,d,l,f){var p=this.stage.getDrawableText(e(this.width,this.height),i(this.height,this.width),s,n,r(this.width,this.height),o,a,h,u,d?d(this.width,this.height):void 0,l?l(this.height,this.width):void 0,f);this.stage.draw(p);var g=this.createInput(p),m=this;return this.resizer.add(p,function(n,o){t(p,e(n,o),i(o,n)),p.data.size=r(n,o),d&&(p.data.maxLineLength=d(n,o)),l&&(p.data.lineHeight=l(o,n)),m.changeInput(g,p)},c),{drawable:p,input:g}},d.prototype.drawRectangle=function(e,i,n,r,o,a,c,u,h,d,l,f){var p=c?c(this.width,this.height):void 0,g=this.stage.drawRectangle(e(this.width,this.height),i(this.height,this.width),n(this.width,this.height),r(this.height,this.width),o,a,p,u,h,d,l);return this.resizer.add(g,function(o,a){t(g,e(o,a),i(a,o));var u=c?c(o,a):void 0;s(g.data,n(o,a),r(a,o),u)},f),g},d.prototype.drawCircle=function(e,i,n,r,o,a,s,c,u,h,d){var l=a?a(this.width,this.height):void 0,f=this.stage.drawCircle(e(this.width,this.height),i(this.height,this.width),n(this.width,this.height),r,o,l,s,c,u,h);return this.resizer.add(f,function(r,o){t(f,e(r,o),i(o,r));var s=a?a(r,o):void 0;f.data.radius=n(r,o),f.data.lineWidth=s},d),f},d.prototype.drawEqTriangle=function(e,i,n,r,o,a,s,c,u,h,d,l){var f=s?s(this.width,this.height):void 0,p=this.stage.drawEqTriangle(e(this.width,this.height),i(this.height,this.width),n,r(this.width,this.height),o,a,f,c,u,h,d);return this.resizer.add(p,function(n,o){t(p,e(n,o),i(o,n));var a=s?s(n,o):void 0;p.data.radius=r(n,o),p.data.lineWidth=a},l),p},d.prototype.drawRectangleWithInput=function(e,i,n,r,o,a,c,u,h,d,l,f){var p=c?c(this.width,this.height):void 0,g=this.stage.drawRectangle(e(this.width,this.height),i(this.height,this.width),n(this.width,this.height),r(this.height,this.width),o,a,p,u,h,d,l),m=this.createInput(g),v=this;return this.resizer.add(g,function(o,a){t(g,e(o,a),i(a,o));var u=c?c(o,a):void 0;s(g.data,n(o,a),r(a,o),u),v.changeInput(m,g)},f),{drawable:g,input:m}},d.prototype.resize=function(t){this.width=t.width,this.height=t.height,this.gfx&&this.gfx.resize&&this.gfx.resize(t),this.stage.resize(t),this.resizer.call(t.width,t.height),o(this.collisions,function(e){e.resize(t)})},d.prototype.animateFresh=function(e,i,n,r,o,a,s,c,u,h){var d=this.stage.animateFresh(e(this.width,this.height),i(this.height,this.width),n,r,o,s,c,u,h);return this.resizer.add(d.drawable,function(n,r){t(d.drawable,e(n,r),i(r,n))},a),d},d.prototype.moveFresh=function(i,n,r,o,a,s,c,u,h,d,l,f,p,g){var m,v=this,y=function(){v.resizer.add(_.drawable,function(e,i){t(_.drawable,o(e,i),a(i,e))},d)};m=h?u?h:function(){h(),y()}:u?void 0:y;var _=this.stage.moveFresh(i(this.width,this.height),n(this.height,this.width),r,o(this.width,this.height),a(this.height,this.width),s,c,u,m,l,f,p,g);return this.resizer.add(_.drawable,function(r,s){t(_.drawable,i(r,s),n(s,r)),e(_.path,i(r,s),n(s,r),o(r,s),a(s,r))},d),_},d.prototype.moveFreshText=function(i,n,r,o,a,s,c,u,h,d,l,f,p,g,m,v,y,_){var w,b=this,S=function(){b.resizer.add(T.drawable,function(e,i){t(T.drawable,c(e,i),u(i,e)),T.drawable.data.size=o(e,i),y&&(T.drawable.data.maxLineLength=y(e,i)),_&&(T.drawable.data.lineHeight=_(i,e))},p)};w=f?function(){S(),f()}:S;var T=this.stage.moveFreshText(i(this.width,this.height),n(this.height,this.width),r,o(this.width,this.height),a,s,c(this.width,this.height),u(this.height,this.width),h,d,l,w,g,m,v,y?y(this.width,this.height):void 0,_?_(this.height,this.width):void 0);return this.resizer.add(T.drawable,function(r,a){t(T.drawable,i(r,a),n(a,r)),T.drawable.data.size=o(r,a),y&&(T.drawable.data.maxLineLength=y(r,a)),_&&(T.drawable.data.lineHeight=_(a,r)),e(T.path,i(r,a),n(a,r),c(r,a),u(a,r))},p),T},d.prototype.moveFreshRoundTrip=function(i,n,r,o,a,s,c,u,h,d,l,f,p,g,m){var v,y=this,_=function(){y.resizer.add(T.drawable,function(r,s){t(T.drawable,o(r,s),a(s,r)),e(T.pathTo,i(r,s),n(s,r),o(r,s),a(s,r)),e(T.pathReturn,o(r,s),a(s,r),i(r,s),n(s,r))},l)};v=h?function(){h(),_()}:_;var w,b=function(){y.resizer.add(T.drawable,function(r,s){t(T.drawable,i(r,s),n(s,r)),e(T.pathTo,i(r,s),n(s,r),o(r,s),a(s,r)),e(T.pathReturn,o(r,s),a(s,r),i(r,s),n(s,r))},l)},S=function(){u?b():y.resizer.add(T.drawable,function(e,r){t(T.drawable,i(e,r),n(r,e))},l)};w=h?function(){h(),S()}:S;var T=this.stage.moveFreshRoundTrip(i(this.width,this.height),n(this.height,this.width),r,o(this.width,this.height),a(this.height,this.width),s,c,u,v,w,f,p,g,m);return b(),T},d.prototype.moveFreshLater=function(t,e,i,n,r,o,s,c,u,h,d,l,f,p,g,m){var v={},y=this;return this.timer.doLater(function(){d&&d();var c=y.moveFresh(t,e,i,n,r,o,s,u,h,l,f,p,g,m);a.keys(c).forEach(function(t){v[t]=c[t]})},c),v},d.prototype.moveFreshTextLater=function(t,e,i,n,r,o,s,c,u,h,d,l,f,p,g,m,v,y,_,w){var b={},S=this;return this.timer.doLater(function(){var d=S.moveFreshText(t,e,i,n,r,o,s,c,u,h,l,f,g,m,v,y,_,w);a.keys(d).forEach(function(t){b[t]=d[t]}),p&&p()},d),b},d.prototype.move=function(i,n,o,a,s,c,h,d){var l,f={id:i.id+"_1"},p=this,g=function(){if(p.resizer.remove(f),i.data instanceof r||i.data instanceof u){var e={id:i.id+"_2"};p.resizer.add(e,function(e,r){t(i,n(e,r),o(r,e))},d)}else d=d.filter(function(t){return t.id!=i.id}),p.resizer.add(i,function(e,r){t(i,n(e,r),o(r,e))},d)};l=h?function(){g(),h()}:g;var m=this.stage.getPath(i.x,i.y,n(this.width,this.height),o(this.height,this.width),a,s,c);this.stage.move(i,m,l),d?d.push(i):d=[i],this.resizer.add(f,function(t,r){e(m,i.x,i.y,n(t,r),o(r,t))},d)},d.prototype.moveCircular=function(i,n,o,a,s,c,d,l,f,p,g){var m,v={id:i.id+"_1"},y=this,_=function(){if(y.resizer.remove(v),i.data instanceof r||i.data instanceof u){var e={id:i.id+"_2"};y.resizer.add(e,function(e,r){t(i,h.getX(n(e,r),a(e,r),c),h.getY(o(r,e),a(e,r),c))},g)}else g=g.filter(function(t){return t.id!=i.id}),y.resizer.add(i,function(e,r){t(i,h.getX(n(e,r),a(e,r),c),h.getY(o(r,e),a(e,r),c))},g)};m=p?f?p:function(){_(),p()}:f?void 0:_;var w=this.stage.moveCircular(i,n(this.width,this.height),o(this.height,this.width),a(this.width,this.height),s,c,d,l,f,m);g?g.push(i):g=[i],this.resizer.add(v,function(t,i){e(w,n(t,i),o(i,t),a(t,i))},g)},d.prototype.moveRoundTrip=function(t,e,i,n,r,o,a,s,c,u,h,d,l){},d.prototype.moveLater=function(t,e,i,n,r,o,a,s,c,u){var h=this;this.timer.doLater(function(){u&&u(),h.move(t,e,i,n,r,o,a,s)},c)},d.prototype.remove=function(t){this.resizer.remove(t);var e={id:t.id+"_1"};this.resizer.remove(e);var i={id:t.id+"_2"};this.resizer.remove(i),t.mask&&this.unmask(t),this.stage.remove(t)},d.prototype.show=function(t){this.stage.draw(t)},d.prototype.hide=function(t){this.stage.remove(t)},d.prototype.has=function(t){return this.resizer.has(t)||this.stage.has(t)};var l="_mask";return d.prototype.mask=function(t,e,i,n,r){var o=this.stage.mask(t,e(this.width,this.height),i(this.height,this.width),n(this.width,this.height),r(this.height,this.width)),a={id:t.id+l};return this.resizer.add(a,function(t,a){c(o,e(t,a),i(a,t),n(t,a),r(a,t))},[t]),o},d.prototype.unmask=function(t){var e={id:t.id+l};this.resizer.remove(e),this.stage.unmask(t)},d.prototype.update=function(){this.timer.update(),this.stage.update()},d}(changeCoords,changePath,CanvasImageCollisionDetector,inheritMethods,TextWrapper,iterateEntries,Object,changeRectangle,changeMask,Rectangle,Vectors),ImageCache=function(t,e){"use strict";function i(t,e,i){this.defaultScreenHeight=i||3840,this.imgDict={},this.defaultScaleFactor=e/this.defaultScreenHeight}return i.prototype.add=function(e,i){this.imgDict[e]=new t(i,i.width,i.height,this.defaultScaleFactor)},i.prototype.get=function(t){return this.imgDict[t]},i.prototype.resize=function(t){var i=this.defaultScaleFactor=t.height/this.defaultScreenHeight;e(this.imgDict,function(t){t.scale=i})},i}(ImageWrapper,iterateEntries),AtlasCache=function(t,e,i){"use strict";function n(t,e,i){this.defaultScreenHeight=i||3840,this.atlasDict={},this.defaultScaleFactor=e/this.defaultScreenHeight}return n.prototype.init=function(t){var e=this;t.forEach(function(t){var i=t.atlas,n=t.info;n.frames.forEach(function(t){e.atlasDict[t.filename]=e._createSubImage(t,i,e.defaultScaleFactor)})})},n.prototype._getOffSetFromCenterX=function(t,i){return e.floor((t.spriteSourceSize.x-.5*t.sourceSize.w)*i)},n.prototype._getOffSetFromCenterY=function(t,i){return e.floor((t.spriteSourceSize.y-.5*t.sourceSize.h)*i)},n.prototype._createSubImage=function(e,i,n){return new t(e.frame.x,e.frame.y,e.frame.w,e.frame.h,this._getOffSetFromCenterX(e,1),this._getOffSetFromCenterY(e,1),e.spriteSourceSize.w,e.spriteSourceSize.h,this._getOffSetFromCenterX(e,n),this._getOffSetFromCenterY(e,n),e.spriteSourceSize.w*n,e.spriteSourceSize.h*n,i)},n.prototype.get=function(t){return this.atlasDict[t]},n.prototype.resize=function(t){var n=this.defaultScaleFactor=t.height/this.defaultScreenHeight;i(this.atlasDict,function(t){t.scaledOffSetX=e.floor(t.offSetX*n),t.scaledOffSetY=e.floor(t.offSetY*n),t.scaledTrimmedWidth=e.floor(t.trimmedWidth*n),t.scaledTrimmedHeight=e.floor(t.trimmedHeight*n)})},n}(SubImage,Math,iterateEntries),installOneTimeTap=function(t){"use strict";function e(e,i){function n(r){r.preventDefault(),"ontouchstart"in t&&e.removeEventListener("touchstart",n),e.removeEventListener("click",n),i(r)}"ontouchstart"in t&&e.addEventListener("touchstart",n),e.addEventListener("click",n)}return e}(window),Orientation={PORTRAIT:0,LANDSCAPE:1},range=function(t){"use strict";function e(e,i){return t.floor(t.random()*(i-e+1))+e}return e}(Math),ButtonFactory=function(t,e){"use strict";function i(t,e,i,n,r,o,a,s,c,u,h,d,l){this.stage=t,this.input=e,this.font=n,this.playSound=r,this.timer=i,this.primaryColor=o,this.primaryTextColor=a,this.primaryTextSize=s,this.primaryWidthFactor=c,this.secondaryColor=u,this.secondaryTextColor=h,this.secondaryTextSize=d,this.secondaryWidthFactor=l}return i.prototype.createPrimaryButton=function(t,e,i,n,r,o,a,s){function c(t,e){e.alpha=1}function u(t,e){e.alpha=.5}return this.__createButton(t,e,i,this.primaryTextSize,this.primaryColor,this.primaryTextColor,1,n,!0,void 0,this.primaryWidthFactor,c,u,r,o,a,s)},i.prototype.createSecondaryButton=function(t,e,i,n,r,o,a,s){function c(t,e){t.alpha=1,e.data.filled=!0}function u(t,e){t.alpha=.5,e.data.filled=!1}return this.__createButton(t,e,i,this.secondaryTextSize,this.secondaryColor,this.secondaryTextColor,.5,n,!1,function(){return 1},this.secondaryWidthFactor,c,u,r,o,a,s)},i.prototype.__createButton=function(i,n,r,o,a,s,c,u,h,d,l,f,p,g,m,v,y){function _(t){var i=e.get(10,9)(t),n=S.getWidth()*l;return i>=n?n:i}function w(){return t.floor(2.5*S.getHeight())}var b=void 0!==m?m:!1,S=this.stage.drawText(i,n,r,o,this.font,s,g+1,void 0,void 0,c),T=this.stage.drawRectangleWithInput(i,n,v?v:_,y?y:w,a,h,d,g,.5,void 0,void 0,[S]),E=T.input,x=T.drawable,A={text:S,background:x,input:E,used:!1,reset:!0},R=this,P=function(){(b||!A.used)&&(A.used=!0,f(S,x),R.playSound(),A.reset&&R.timer.doLater(p.bind(void 0,S,x),30),u())};return this.input.add(E,P),A},i.prototype.enable=function(t){this.input.enable(t.input)},i.prototype.disable=function(t){this.input.disable(t.input)},i.prototype.enableAll=function(){this.input.enableAll()},i.prototype.disableAll=function(){this.input.disableAll()},i.prototype.remove=function(t){this.stage.remove(t.text),this.stage.remove(t.background),this.input.remove(t.input)},i}(Math,Width),SceneManager=function(){"use strict";function t(){this.scenes=[],this.temp=[]}return t.prototype.add=function(t,e){this.scenes.push({sceneFn:t,oneTime:null==e?!1:e})},t.prototype.next=function(){0===this.scenes.length&&this.temp.length>0&&this.rewind();var t=this.scenes.shift();t.oneTime||this.temp.push(t),t.sceneFn(this.next.bind(this))},t.prototype.rewind=function(){this.scenes=this.temp,this.temp=[]},t}();Zone.prototype.newContent=function(t){this.content=t,this.content.zone=this},Zone.prototype.doTick=function(){this.content.doTick()},Zone.prototype.leftState=function(){return this.leftZone.getState()},Zone.prototype.rightState=function(){return this.rightZone.getState()},Zone.prototype.getState=function(){return this.content.getState()},Zone.prototype.act=function(){this.content.act()},Zone.prototype.connectOnTheLeft=function(t){this.leftZone=t,t.rightZone||t.connectOnTheRight(this)},Zone.prototype.connectOnTheRight=function(t){this.rightZone=t,t.leftZone||t.connectOnTheLeft(this)},Ocean.prototype.getState=function(){return{art:"ocean",state:this.pollution}},Ocean.prototype.act=function(){this.pollution>0&&this.pollution--},Ocean.prototype.doTick=function(){if(nextToAtLeastMediumVillage(this)){var t=range(0,100);t>=95&&this.pollution<2&&this.pollution++}},Village.prototype.getState=function(){return{art:"village",state:this.size}},Village.prototype.act=function(){},Village.prototype.doTick=function(){if(nextToPollutedOcean(this)){var t=range(0,100);t>=95&&(this.size>0?this.size--:this.zone.newContent(new Space))}else if(nextToAtLeastMediumCleanWater(this)||nextToBigVillage(this)){var t=range(0,100);t>=80&&this.size<2&&this.size++}},Space.prototype.getState=function(){return{art:"space",state:0}},Space.prototype.act=function(){this.seeded=0},Space.prototype.doTick=function(){if(void 0!==this.seeded){this.seeded++;var t=range(0,100);t>=95&&this.zone.newContent(new Forrest(0))}if(nextToBigVillage(this)&&!nextToPollutedOcean(this)){var t=range(0,100);t>=75&&this.zone.newContent(new Village(0))}},Forrest.prototype.getState=function(){return{art:"forrest",state:this.value}},Forrest.prototype.act=function(){this.value>0?this.value--:this.zone.newContent(new Space)},Forrest.prototype.doTick=function(){if(nextToPollutedOcean(this)){var t=range(0,100);t>=95&&(this.value>0?this.value--:this.zone.newContent(new Space))}else if(this.value<2){var t=range(0,100);t>=95&&this.value++}};var zone1=new Zone(new Ocean(0)),zone2=new Zone(new Village(1)),zone3=new Zone(new Forrest(1)),zone4=new Zone(new Forrest(2)),zone5=new Zone(new Space),zone6=new Zone(new Village(0)),zone7=new Zone(new Forrest(1)),zone8=new Zone(new Forrest(2));zone1.connectOnTheRight(zone2),zone2.connectOnTheRight(zone3),zone3.connectOnTheRight(zone4),zone4.connectOnTheRight(zone5),zone5.connectOnTheRight(zone6),zone6.connectOnTheRight(zone7),zone7.connectOnTheRight(zone8),zone8.connectOnTheRight(zone1);var environment={actions:5,zones:[zone1,zone2,zone3,zone4,zone5,zone6,zone7,zone8],doTick:function(){for(i=0;i<this.zones.length;i++)this.zones[i].doTick()},getZones:function(){return this.zones}},TitleScreen=function(){"use strict";function t(t){this.stage=t.stage,this.buttons=t.buttons}return t.prototype.show=function(t){var e=this,i=this.stage.drawFresh(Width.HALF,Height.HALF,"title_screen"),n=this.buttons.createPrimaryButton(Width.HALF,Height.get(10,9),"start",function(){e.stage.remove(i),e.buttons.remove(n),t()},3)},t}(),HelloWorld=function(){"use strict";function t(t){this.stage=t.stage}return t.prototype.show=function(t){this.stage.drawText(Width.HALF,Height.HALF,"Hello World",Font._10,"arial","black")},t}(),Play=function(t){"use strict";function e(t){this.stage=t.stage,this.events=t.events,this.sounds=t.sounds}var i=!1;return e.prototype.show=function(e){function n(t,e){return f(e)}function r(){v.forEach(function(t){t.graphic&&l.stage.remove(t.graphic)});for(var t=0;g>t;t++)v.push(a(t))}function o(){y=t.getZones()}function a(t){var e,n=y[t],r=m*t+Math.PI/2,o=n.getState(),a=o.art+"_"+o.state;0===a.indexOf("ocean")?0===a.indexOf("ocean_0")?e=l.stage.animateFresh(c(t),d(t),"ocean/ocean_0",73,!0,void 0,5,void 0,r).drawable:0===a.indexOf("ocean_1")?e=l.stage.animateFresh(c(t),d(t),"ocean/ocean_1",49,!0,void 0,5,void 0,r).drawable:0===a.indexOf("ocean_2")&&(e=l.stage.animateFresh(c(t),d(t),"ocean/ocean_2",13,!0,void 0,5,void 0,r).drawable):0===a.indexOf("forrest")?0===a.indexOf("forrest_0")?e=l.stage.animateFresh(c(t),d(t),"forrest/forrest_0",25,!0,void 0,5,void 0,r).drawable:0===a.indexOf("forrest_1")?e=l.stage.animateFresh(c(t),d(t),"forrest/forrest_1",25,!0,void 0,5,void 0,r).drawable:0===a.indexOf("forrest_2")&&(e=l.stage.animateFresh(c(t),d(t),"forrest/forrest_2",25,!0,void 0,5,void 0,r).drawable):0===a.indexOf("village")&&(e=l.stage.drawFresh(c(t),d(t),a,4,void 0,void 0,m*t+Math.PI/2));var f=l.stage.drawRectangle(c(t),d(t),u,h,"black",!1,wrap(1),4,void 0,r);i||(f.show=!1);var p=l.stage.drawCircle(c(t),d(t),s,"blue",!1,wrap(1),4);return i||(p.show=!1),{input:p,graphic:e,debug:f,callback:n.act.bind(n)}}function s(t,e){return Height.get(15)(e)}function c(t){return function(e,i){return Vectors.getX(Width.HALF(e),f(i),m*t)}}function u(t,e){return Height.get(5)(e)}function h(t,e){return Height.get(15)(t)}function d(t){return function(e,i){return Vectors.getY(Height.HALF(e),f(e),m*t)}}var l=this;this.sounds.play("music");var f=Height.get(5),p=this.stage.drawCircle(Width.HALF,Height.HALF,n,"red",!1,wrap(1),4);i||(p.show=!1);var g=(this.stage.drawFresh(Width.HALF,Height.HALF,"world1"),8),m=2*Math.PI/g,v=[],y=t.getZones(),_=(this.events.subscribe(Event.POINTER,function(t){"down"==t.type&&v.some(function(e,i){var n=e.input,r=Vectors.get(t.x,t.y,n.x,n.y),o=Vectors.magnitude(r.x,r.y),a=n.data.radius>=o;return a?(console.log("click"+i),e.callback&&e.callback(),!0):!1})}),0);this.events.subscribe(Event.TICK_MOVE,function(){60==++_&&(_=0,t.doTick(),o(),r())});o(),r()},e}(environment),installMyScenes=function(t,e,i,n){"use strict";function r(r){var c=new e;r.tap=c,r.events.subscribe(i.POINTER,c.inputChanged.bind(c)),r.buttons=new n(r.stage,c,r.timer,s,function(){},a,o,Font._30,3,a,a,Font._40,2);var u=new t,h=new TitleScreen(r);u.add(h.show.bind(h));var d=new Play(r);return u.add(d.show.bind(d)),u}var o="#283032",a="#fff",s="arial";return r}(SceneManager,TapManager,Event,ButtonFactory),GameLoop=function(t,e){"use strict";function i(t){this.events=t,this.isMove=!0,this.isCollision=!0}return i.prototype.run=function(){t(this.run.bind(this)),this.events.fireSync(e.TICK_START),this.events.update(),this.events.fireSync(e.TICK_INPUT),this.isMove&&this.events.fireSync(e.TICK_MOVE),this.isCollision&&this.events.fireSync(e.TICK_COLLISION),this.events.fireSync(e.TICK_CAMERA),this.events.fireSync(e.TICK_DRAW),this.events.fireSync(e.TICK_END)},i.prototype.disableMove=function(){this.isMove=!1},i.prototype.enableMove=function(){this.isMove=!0},i.prototype.disableCollision=function(){this.isCollision=!1},i.prototype.enableCollision=function(){this.isCollision=!0},i}(requestAnimFrame,Event),installLoop=function(t,e){"use strict";function i(i,n){var r=new t(n);return n.subscribe(e.TICK_DRAW,i.update.bind(i)),n.subscribe(e.TICK_START,n.updateDeletes.bind(n)),r.run(),r}return i}(GameLoop,Event),StageFactory=function(t){"use strict";function e(e){var i=new t.Renderer(e);return i.registerRenderer(t.SubImage.prototype,t.renderAtlas),i.registerRenderer(t.TextWrapper.prototype,t.renderText),i.registerRenderer(t.Rectangle.prototype,t.renderRectangle),i.registerRenderer(t.Circle.prototype,t.renderCircle),i.registerRenderer(t.DrawableLine.prototype,t.renderLine),i}function i(e){var i=new t.Renderer(e);return i.registerRenderer(t.ImageWrapper.prototype,t.renderImage),i.registerRenderer(t.TextWrapper.prototype,t.renderText),i.registerRenderer(t.Rectangle.prototype,t.renderRectangle),i.registerRenderer(t.Circle.prototype,t.renderCircle),i.registerRenderer(t.DrawableLine.prototype,t.renderLine),i}function n(e,i){var n=new t.Motions(new t.BasicAnimations),r=new t.SpriteAnimations,o=new t.BasicAnimations,a=new t.BasicAnimationHelper(o),s=new t.CallbackTimer;return new t.Stage(e,n,new t.MotionTimer(n,s),new t.MotionHelper(n),r,new t.SpriteTimer(r,s),o,a,new t.BasicAnimationTimer(o,s),new t.PropertyAnimations(o,a),i,s)}function r(e,i,r,o){var a=new t.ResizableStage(n(e,i),e,new t.Repository,t.Touchables.get,t.fetchDrawableIntoTouchable,r.width,r.height,new t.CallbackTimer);return o.subscribe(t.Event.RESIZE,a.resize.bind(a)),a}return{getResponsiveAtlasStage:function(t,i,n,o){return r(i,e(t),n,o)},getAtlasStage:function(t,i){return n(i,e(t))},getResponsiveImageStage:function(t,e,n,o){return r(e,i(t),n,o)},getImageStage:function(t,e){return n(e,i(t))}}}({Renderer:Renderer,renderImage:renderImage,renderText:renderText,renderAtlas:renderAtlas,SubImage:SubImage,TextWrapper:TextWrapper,ImageWrapper:ImageWrapper,Stage:Stage,MotionHelper:MotionHelper,MotionTimer:MotionTimer,Motions:Motions,SpriteTimer:SpriteTimer,SpriteAnimations:SpriteAnimations,PropertyAnimations:PropertyAnimations,BasicAnimationHelper:AnimationHelper,BasicAnimationTimer:AnimationTimer,BasicAnimations:BasicAnimations,ResizableStage:ResizableStage,Repository:Repository,Touchables:Touchables,fetchDrawableIntoTouchable:fetchDrawableIntoTouchable,CallbackTimer:CallbackTimer,Rectangle:Rectangle,renderRectangle:renderRectangle,Circle:Circle,renderCircle:renderCircle,DrawableLine:DrawableLine,renderLine:renderLine,Event:Event}),AtlasResourceHelper=function(t,e,i,n,r,o){"use strict";function a(t,r,a){var s=e(o.floor(i*u),o.floor(n*u),a);c=s.defaultSize,s.paths.forEach(function(e){r.push({atlas:t.addImage(e.gfx),info:t.addJSON(e.data)})})}function s(e,i,n){var r=new t(o.floor(i*u),o.floor(n*u),c);return r.init(e),r}var c,u=r();return{register:a,process:s}}(AtlasCache,resolveAtlasPaths,window.screen.availWidth,window.screen.availHeight,getDevicePixelRatio,Math),ImageResourceHelper=function(t,e,i,n){"use strict";function r(t,e,i){e.forEach(function(e){i[e]=t.addImage(a+e+s)})}function o(r,o,a,s){var c=i(),u=new t(n.floor(o*c),n.floor(a*c),s);return e.keys(r).forEach(function(t){u.add(t,r[t])}),u}var a="gfx/",s=".png";return{register:r,process:o}}(ImageCache,Object,getDevicePixelRatio,Math),MyGameResources=function(t,e,i,n,r,o,a,s,c,u,h){"use strict";function d(t){f=t.addFont("data/gamefont.woff"),p=t.addJSON("data/locales.json");var e=new u(c,a,s,1).isMobile;return n.register(t,m,e),2+m.length}function l(){r&&t([{name:g,url:r.createObjectURL(f.blob)}]);var o=new i;return o.load(["music"]),{messages:new e(p),sounds:o,gfxCache:n.process(m,a,s)}}var f,p,g="GameFont",m=[];return{create:d,process:l}}(addFontToDOM,UniversalTranslator,SoundFilesManager,AtlasResourceHelper,window.URL||window.webkitURL,window.document,window.innerWidth,window.innerHeight,window.navigator.userAgent,DeviceInfo,window),ResizeHandler=function(t,e,i){"use strict";function n(t){this.events=t}return n.prototype.handleResize=function(n){var r=n.target.innerWidth,o=n.target.innerHeight,a=t();this.events.fire(e.RESIZE,{width:i.floor(r*a),height:i.floor(o*a),cssWidth:r,cssHeight:o,devicePixelRatio:a})},n}(getDevicePixelRatio,Event,Math),SimpleLoadingScreen=function(t){"use strict";function e(t){this.screenCtx=t,this.startBarX=0,this.startBarY=0,this.barWidth=0,this.barHeight=0,this.progressCounter=1,this.parts=0,this.txt="LOADING"}return e.prototype.showNew=function(t){this.progressCounter=1,this.parts=t,this._calcScreenPositions(this.screenCtx.canvas.width,this.screenCtx.canvas.height),this._initialRendering()},e.prototype.showProgress=function(){this.progressCounter<=this.parts&&(this.screenCtx.fillRect(this.startBarX,this.startBarY,this.barWidth/this.parts*this.progressCounter,this.barHeight),this.progressCounter++)},e.prototype.resize=function(t){this._resizeScreen(t.width,t.height),this._calcScreenPositions(t.width,t.height),this._initialRendering(),this.screenCtx.fillRect(this.startBarX,this.startBarY,this.barWidth/this.parts*this.progressCounter,this.barHeight)},e.prototype._calcScreenPositions=function(e,i){this.centerX=t.floor(e/2),this.startBarX=e/4,this.startBarY=i/6,this.barWidth=e-2*this.startBarX,this.barHeight=i-2*this.startBarY},e.prototype._initialRendering=function(){this.screenCtx.strokeRect(this.startBarX,this.startBarY,this.barWidth,this.barHeight),this.screenCtx.font="italic 40pt Calibri",this.screenCtx.textAlign="center",this.screenCtx.fillText(this.txt,this.centerX,this.startBarY+this.barHeight+40)},e.prototype._resizeScreen=function(t,e){this.screenCtx.canvas.width=t,this.screenCtx.canvas.height=e},e}(Math),OrientationHandler=function(t,e,i,n){"use strict";function r(t){this.events=t,this.lastOrientation=-1}return r.prototype.orientationType=function(){var t=/portrait/i.test(i.orientation.type)?e.PORTRAIT:e.LANDSCAPE;this.__fireEvent(t)},r.prototype.screenOrientation=function(){var t=i.orientation||i.mozOrientation||i.msOrientation,n=/portrait/i.test(t)?e.PORTRAIT:e.LANDSCAPE;this.__fireEvent(n)},r.prototype.windowOrientation=function(){var i;switch(t.orientation){case 0:i=e.PORTRAIT;break;case-90:i=e.LANDSCAPE;break;case 90:i=e.LANDSCAPE;break;case 180:i=e.PORTRAIT}this.__fireEvent(i)},r.prototype.handleResize=function(){var i=t.innerWidth>t.innerHeight?e.LANDSCAPE:e.PORTRAIT;this.__fireEvent(i)},r.prototype.__fireEvent=function(t){this.lastOrientation!==t&&(this.events.fire(n.SCREEN_ORIENTATION,t),this.lastOrientation=t)},r}(window,Orientation,window.screen,Event),VisibilityHandler=function(t,e){"use strict";function i(e){this.events=e,this.lastState=void 0!==t.hidden?t.hidden:t.webkitHidden}return i.prototype.handleVisibility=function(){var i=void 0!==t.hidden?t.hidden:t.webkitHidden;this.lastState!==i&&(this.events.fireSync(e.PAGE_VISIBILITY,i),this.lastState=i)},i}(window.document,Event),FullScreenHandler=function(t){"use strict";function e(t,e){this.controller=t,this.events=e}return e.prototype.change=function(){this.events.fire(t.FULL_SCREEN,this.controller.isFullScreen())},e}(Event),ResourceLoader=function(t,e,i,n,r){"use strict";function o(){this.resources=[],this.resourcesLoaded=0}var a={IMAGE:0,SOUND:1,JSON:2,FONT:3};return o.prototype.addImage=function(t){var e=new i;return this.resources.push({type:a.IMAGE,file:e,src:t}),e},o.prototype.addJSON=function(t){var e={};return this.resources.push({type:a.JSON,file:e,src:t}),e},o.prototype.addFont=function(t){if(r){var e={};return this.resources.push({type:a.FONT,file:e,src:t}),e}},o.prototype.load=function(){if(this.resources.length==this.resourcesLoaded&&this.onComplete)return void this.onComplete();var i=this;i.resources.forEach(function(r){if(r.type===a.IMAGE)r.file.onload=function(){i.onResourceLoad()},r.file.src=r.src;else if(r.type===a.JSON){var o=new XMLHttpRequest;o.open("GET",r.src,!0),o.onload=function(){var t=JSON.parse(this.responseText);n.keys(t).forEach(function(e){r.file[e]=t[e]}),i.onResourceLoad()},o.send()}else if(r.type===a.FONT){var s=new XMLHttpRequest;s.open("GET",r.src,!0),s.responseType="arraybuffer",s.onload=function(){if(e){var n=new e;n.append(s.response),r.file.blob=n.getBlob()}else t&&(r.file.blob=new t([s.response],{type:"application/font-woff"}));i.onResourceLoad()},s.send()}})},o.prototype.onResourceLoad=function(){this.resourcesLoaded++;var t=this.onProgress;if(void 0!==t&&"function"==typeof t&&t(),this.resourcesLoaded===this.resources.length){var e=this.onComplete;void 0!==e&&"function"==typeof e&&e()}},o}(Blob,window.WebKitBlobBuilder,Image,Object,window.URL||window.webkitURL),installCanvas=function(t,e,i){"use strict";function n(n,r,o,a,s,c,u){var h=t.createElement("canvas");if(c&&u){h.width=c,h.height=u,h.style.display="none";var d=i.floor(o/c),l=c*d,f=u*d;r.screenScale=d;var p=t.createElement("canvas");p.width=l,p.height=f;var g=p.getContext("2d");"imageSmoothingEnabled"in g?g.imageSmoothingEnabled=!1:"mozImageSmoothingEnabled"in g?g.mozImageSmoothingEnabled=!1:"webkitImageSmoothingEnabled"in g?g.webkitImageSmoothingEnabled=!1:"msImageSmoothingEnabled"in g&&(g.msImageSmoothingEnabled=!1),t.body.appendChild(p),n.subscribe(e.RESIZE,function(t){var e=i.floor(t.width/c);l=c*e,f=u*e,p.width=l,p.height=f,r.screenScale=e}),n.subscribe(e.TICK_END,function(){g.clearRect(0,0,l,f),g.drawImage(h,0,0,c,u,0,0,l,f)})}else s>1?(h.style.width=o+"px",h.style.height=a+"px",h.width=i.floor(o*s),h.height=i.floor(a*s)):(h.width=o,h.height=a);return t.body.appendChild(h),{screen:h,scaledScreen:p}}return n}(window.document,Event,Math),installResize=function(t,e,i){"use strict";function n(n,r){var o=new e(n);t.addEventListener("resize",o.handleResize.bind(o)),n.subscribe(i.RESIZE,function(t){r.width=t.width,r.height=t.height,r.cssWidth=t.cssWidth,r.cssHeight=t.cssHeight,r.devicePixelRatio=t.devicePixelRatio}),r.forceResize=function(){n.fire(i.RESIZE,{width:this.width,height:this.height,cssWidth:this.cssWidth,cssHeight:this.cssHeight,devicePixelRatio:this.devicePixelRatio})}}return n}(window,ResizeHandler,Event),installOrientation=function(t,e,i,n){"use strict";function r(r,o){var a=new i(r);"orientation"in e&&"angle"in e.orientation?(a.orientationType(),e.orientation.addEventListener("change",a.orientationType.bind(a))):e.orientation||e.mozOrientation||e.msOrientation?(a.screenOrientation(),e.addEventListener("orientationchange",a.screenOrientation.bind(a)),e.addEventListener("MSOrientationChange",a.screenOrientation.bind(a)),e.addEventListener("mozorientationchange",a.screenOrientation.bind(a))):t.orientation?(a.windowOrientation(),t.addEventListener("orientationchange",a.windowOrientation.bind(a))):(a.handleResize(),t.addEventListener("resize",a.handleResize.bind(a))),o.orientation=a.lastOrientation,r.subscribe(n.SCREEN_ORIENTATION,function(t){o.orientation=t})}return r}(window,window.screen,OrientationHandler,Event),installVisibility=function(t,e,i){"use strict";function n(n,r){var o=new t(n);if(void 0!==e.hidden)e.addEventListener("visibilitychange",o.handleVisibility.bind(o));else{if(void 0===e.webkitHidden)return;e.addEventListener("webkitvisibilitychange",o.handleVisibility.bind(o))}r.pageHidden=o.lastState,n.subscribe(i.PAGE_VISIBILITY,function(t){r.pageHidden=t})}return n}(VisibilityHandler,window.document,Event),installFullScreen=function(t,e,i){"use strict";function n(n,r){var o=new e(n),a=new i(o,r);return o.isSupported&&(t.addEventListener("fullscreenchange",a.change.bind(a)),t.addEventListener("webkitfullscreenchange",a.change.bind(a)),t.addEventListener("mozfullscreenchange",a.change.bind(a)),t.addEventListener("MSFullscreenChange",a.change.bind(a))),o}return n}(window.document,FullScreenController,FullScreenHandler),installPointer=function(t,e,i){"use strict";function n(n,r,o){var a=new t(n,r);return i.PointerEvent?(o.addEventListener("pointerdown",a.pointerDown.bind(a)),o.addEventListener("pointermove",a.pointerMove.bind(a)),o.addEventListener("pointerup",a.pointerUp.bind(a)),o.addEventListener("pointerout",a.pointerCancel.bind(a))):i.MSPointerEvent?(o.addEventListener("MSPointerDown",a.pointerDown.bind(a)),o.addEventListener("MSPointerMove",a.pointerMove.bind(a)),o.addEventListener("MSPointerUp",a.pointerUp.bind(a)),o.addEventListener("MSPointerOut",a.pointerCancel.bind(a))):("ontouchstart"in i&&(o.addEventListener("touchstart",a.touchStart.bind(a)),o.addEventListener("touchmove",a.touchMove.bind(a)),o.addEventListener("touchend",a.touchEnd.bind(a)),o.addEventListener("touchcancel",a.touchCancel)),o.addEventListener("mousedown",a.mouseDown.bind(a)),o.addEventListener("mousemove",a.mouseMove.bind(a)),o.addEventListener("mouseup",a.mouseUp.bind(a)),o.addEventListener("mouseout",a.mouseCancel.bind(a))),n.subscribe(e.TICK_INPUT,a.update.bind(a)),a}return n}(PointerHandler,Event,window),installKeyBoard=function(t,e,i){
"use strict";function n(n){var r=new e(n);return t.addEventListener("keydown",r.keyDown.bind(r)),t.addEventListener("keyup",r.keyUp.bind(r)),n.subscribe(i.TICK_INPUT,r.update.bind(r)),r}return n}(window,KeyHandler,Event),installGamePad=function(t,e,i,n,r,o,a,s){"use strict";function c(o){if("wiiu"in t){var c=t.wiiu.gamepad,u=(t.wiiu.remote,new n(o,new r(c,c.update())));o.subscribe(i.TICK_INPUT,u.update.bind(u))}else if(a){var h=new s(o);t.onGenericMotionEvent=h.genericMotionEvent.bind(h),t.onKeyDown=h.keyDown.bind(h),t.onKeyUp=h.keyUp.bind(h),o.subscribe(i.TICK_INPUT,h.update.bind(h))}else{var d=new e(o);t.addEventListener("gamepadconnected",d.connect.bind(d)),t.addEventListener("gamepaddisconnected",d.disconnect.bind(d)),o.subscribe(i.TICK_INPUT,d.update.bind(d))}}return c}(window,GamePadHandler,Event,WiiUGamePadHandler,WiiUGamePad,WiiURemote,!1,OuyaGamePadHandler),EventBus=function(t,e){"use strict";function i(){this.dict={},this.idGenerator=0,this.pending={},this.pendingDeletes=[]}return i.prototype.update=function(){e.keys(this.pending).forEach(function(t){var i=this.pending[t],n=this.dict[t];e.keys(n).forEach(function(t){n[t](i)}),delete this.pending[t]},this)},i.prototype.fire=function(t,e){var i=this.dict[t];i&&(null!=e?this.pending[t]=e:this.pending[t]=!0)},i.prototype.fireSync=function(t,i){var n=this.dict[t];n&&e.keys(n).forEach(function(t){n[t](i)})},i.prototype.subscribe=function(t,e){this.dict[t]||(this.dict[t]={});var i=this.idGenerator++;return this.dict[t][i]=e,i},i.prototype.unsubscribe=function(t){this.pendingDeletes.push(t)},i.prototype.__delete=function(e){t(this.dict,function(t){return t[e]?(delete t[e],!0):!1})},i.prototype.updateDeletes=function(){for(this.pendingDeletes.forEach(this.__delete.bind(this));this.pendingDeletes.length>0;)this.pendingDeletes.pop()},i}(iterateSomeEntries,Object),App=function(t){"use strict";function e(t,e,i){this.services=t,this.resources=e,this.getStage=i}return e.prototype.start=function(){var e=new t.ResourceLoader,i=new t.SimpleLoadingScreen(this.services.screen.getContext("2d")),n=this.resources.create(e),r=this.services.events;e.onProgress=i.showProgress.bind(i);var o=r.subscribe(Event.RESIZE,i.resize.bind(i));i.showNew(n);var a=this;e.onComplete=function(){r.unsubscribe(o);var e=a.resources.process();e.stage=a.getStage(a.services.screen,e.gfxCache,a.services.device,r),e.loop=t.installLoop(e.stage,r);var i=new t.CallbackTimer;r.subscribe(t.Event.TICK_MOVE,i.update.bind(i)),e.timer=i,e.sceneStorage={},t.concatenateProperties(a.services,e),a.scenes=t.installScenes(e),a.__run()},e.load()},e.prototype.__run=function(){this.scenes.next()},e}({ResourceLoader:ResourceLoader,SimpleLoadingScreen:SimpleLoadingScreen,installScenes:installMyScenes,installLoop:installLoop,concatenateProperties:concatenateProperties,CallbackTimer:CallbackTimer,Event:Event}),Bootstrapper=function(t){"use strict";function e(e){var i=p?t.installCanvas(v,y,t.width,t.height,t.getDevicePixelRatio(),d,l):t.installCanvas(v,y,t.width,t.height,t.getDevicePixelRatio());if(g){var n=t.installFullScreen(p?i.scaledScreen:i.screen,v);y.requestFullScreen=n.request.bind(n),y.isFullScreen=n.isFullScreen.bind(n),y.isFullScreenSupported=n.__isSupported.bind(n),y.exitFullScreen=n.exit.bind(y)}m&&t.installPointer(v,y,p?i.scaledScreen:i.screen);var r;r=_&&w?t.StageFactory.getResponsiveAtlasStage:_?t.StageFactory.getResponsiveImageStage:w?t.StageFactory.getAtlasStage:t.StageFactory.getImageStage;var o={screen:i.screen,events:v,device:y,scaledScreen:i.scaledScreen};return new t.App(o,e,r)}function i(){return w=!0,f}function n(t,e){return d=t,l=e,p=!0,f}function r(){return t.installOrientation(v,y),y.lockOrientation=t.OrientationLock.lock,y.unlockOrientation=t.OrientationLock.unlock,f}function o(){return t.installVisibility(v,y),f}function a(){return g=!0,f}function s(){return t.installResize(v,y),_=!0,f}function c(){return t.installKeyBoard(v),f}function u(){return t.installGamePad(v),f}function h(){return m=!0,f}var d,l,f={build:e,responsive:s,keyBoard:c,gamePad:u,atlas:i,orientation:r,fullScreen:a,pointer:h,lowRez:n,visibility:o},p=!1,g=!1,m=!1,v=new t.EventBus,y=new t.DeviceInfo(t.userAgent,t.width,t.height,t.getDevicePixelRatio()),_=!1,w=!1;return f}({installCanvas:installCanvas,StageFactory:StageFactory,installResize:installResize,installKeyBoard:installKeyBoard,installGamePad:installGamePad,installOrientation:installOrientation,installFullScreen:installFullScreen,installPointer:installPointer,installVisibility:installVisibility,App:App,EventBus:EventBus,DeviceInfo:DeviceInfo,width:window.innerWidth,height:window.innerHeight,getDevicePixelRatio:getDevicePixelRatio,OrientationLock:OrientationLock,userAgent:window.navigator.userAgent});window.onload=function(){"use strict";var t=Bootstrapper.atlas().pointer().responsive().fullScreen().build(MyGameResources);t.start()};